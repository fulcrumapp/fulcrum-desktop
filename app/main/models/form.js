"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _minidb = require("minidb");

var _fulcrumCore = require("fulcrum-core");

var _record = _interopRequireDefault(require("./record"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class Form extends _fulcrumCore.Form {
  static get tableName() {
    return 'forms';
  }

  static get columns() {
    return [{
      name: 'accountRowID',
      column: 'account_id',
      type: 'integer',
      null: false
    }, {
      name: 'id',
      column: 'resource_id',
      type: 'string',
      null: false
    }, {
      name: 'name',
      column: 'name',
      type: 'string',
      null: false
    }, {
      name: 'version',
      column: 'version',
      type: 'integer',
      null: false
    }, {
      name: 'description',
      column: 'description',
      type: 'string'
    }, {
      name: 'elementsJSON',
      column: 'elements',
      type: 'json',
      null: false
    }, {
      name: 'titleFieldKeysJSON',
      column: 'title_field_keys',
      type: 'json'
    }, {
      name: 'statusFieldJSON',
      column: 'status_field',
      type: 'json'
    }, {
      name: 'geometryTypes',
      column: 'geometry_types',
      type: 'json'
    }, {
      name: 'geometryRequired',
      column: 'geometry_required',
      type: 'boolean'
    }, {
      name: 'projectEnabled',
      column: 'projects_enabled',
      type: 'boolean'
    }, {
      name: 'assignmentEnabled',
      column: 'assignment_enabled',
      type: 'boolean'
    }, {
      name: 'autoAssign',
      column: 'auto_assign',
      type: 'boolean'
    }, {
      name: 'hiddenOnDashboard',
      column: 'hidden_on_dashboard',
      type: 'boolean'
    }, {
      name: 'image',
      column: 'image',
      type: 'string'
    }, {
      name: 'imageLarge',
      column: 'image_large',
      type: 'string'
    }, {
      name: 'imageSmall',
      column: 'image_small',
      type: 'string'
    }, {
      name: 'imageThumbnail',
      column: 'image_thumbnail',
      type: 'string'
    }, {
      name: 'lastSync',
      column: 'last_sync',
      type: 'datetime'
    }, {
      name: 'script',
      column: 'script',
      type: 'string'
    }, {
      name: 'createdAt',
      column: 'server_created_at',
      type: 'datetime'
    }, {
      name: 'updatedAt',
      column: 'server_updated_at',
      type: 'datetime'
    }, {
      name: 'deletedAt',
      column: 'deleted_at',
      type: 'datetime'
    }];
  }

  findEachRecord(where, callback) {
    return _record.default.findEach(this.db, {
      where: { ...where,
        form_id: this.rowID
      }
    }, callback);
  }

  async findRecordsBySQL(sql, values) {
    const tableName = `account_${this._accountRowID}_form_${this.rowID}_view_full`;
    sql = 'SELECT * FROM ' + tableName + (sql ? ' WHERE ' + sql : '');
    const rows = await this.db.all(sql, values);
    const records = [];

    for (const row of rows) {
      const attributes = _record.default.queryRowToAttributes(row);

      const record = new _record.default(attributes, this);
      record._db = this.db;
      records.push(record);
    }

    return records;
  }

}

exports.default = Form;

_minidb.PersistentObject.register(Form);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tYWluL21vZGVscy9mb3JtLmpzIl0sIm5hbWVzIjpbIkZvcm0iLCJGb3JtQmFzZSIsInRhYmxlTmFtZSIsImNvbHVtbnMiLCJuYW1lIiwiY29sdW1uIiwidHlwZSIsIm51bGwiLCJmaW5kRWFjaFJlY29yZCIsIndoZXJlIiwiY2FsbGJhY2siLCJSZWNvcmQiLCJmaW5kRWFjaCIsImRiIiwiZm9ybV9pZCIsInJvd0lEIiwiZmluZFJlY29yZHNCeVNRTCIsInNxbCIsInZhbHVlcyIsIl9hY2NvdW50Um93SUQiLCJyb3dzIiwiYWxsIiwicmVjb3JkcyIsInJvdyIsImF0dHJpYnV0ZXMiLCJxdWVyeVJvd1RvQXR0cmlidXRlcyIsInJlY29yZCIsIl9kYiIsInB1c2giLCJQZXJzaXN0ZW50T2JqZWN0IiwicmVnaXN0ZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7OztBQUVlLE1BQU1BLElBQU4sU0FBbUJDLGlCQUFuQixDQUE0QjtBQUNyQixhQUFUQyxTQUFTLEdBQUc7QUFDckIsV0FBTyxPQUFQO0FBQ0Q7O0FBRWlCLGFBQVBDLE9BQU8sR0FBRztBQUNuQixXQUFPLENBQ0w7QUFBRUMsTUFBQUEsSUFBSSxFQUFFLGNBQVI7QUFBd0JDLE1BQUFBLE1BQU0sRUFBRSxZQUFoQztBQUE4Q0MsTUFBQUEsSUFBSSxFQUFFLFNBQXBEO0FBQStEQyxNQUFBQSxJQUFJLEVBQUU7QUFBckUsS0FESyxFQUVMO0FBQUVILE1BQUFBLElBQUksRUFBRSxJQUFSO0FBQWNDLE1BQUFBLE1BQU0sRUFBRSxhQUF0QjtBQUFxQ0MsTUFBQUEsSUFBSSxFQUFFLFFBQTNDO0FBQXFEQyxNQUFBQSxJQUFJLEVBQUU7QUFBM0QsS0FGSyxFQUdMO0FBQUVILE1BQUFBLElBQUksRUFBRSxNQUFSO0FBQWdCQyxNQUFBQSxNQUFNLEVBQUUsTUFBeEI7QUFBZ0NDLE1BQUFBLElBQUksRUFBRSxRQUF0QztBQUFnREMsTUFBQUEsSUFBSSxFQUFFO0FB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ZCxFQUFsQjtBQUVBUyxNQUFBQSxPQUFPLENBQUNNLElBQVIsQ0FBYUYsTUFBYjtBQUNEOztBQUVELFdBQU9KLE9BQVA7QUFDRDs7QUF6RHdDOzs7O0FBNEQzQ08seUJBQWlCQyxRQUFqQixDQUEwQjlCLElBQTFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGVyc2lzdGVudE9iamVjdCB9IGZyb20gJ21pbmlkYic7XG5pbXBvcnQgeyBGb3JtIGFzIEZvcm1CYXNlIH0gZnJvbSAnZnVsY3J1bS1jb3JlJztcbmltcG9ydCBSZWNvcmQgZnJvbSAnLi9yZWNvcmQnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtIGV4dGVuZHMgRm9ybUJhc2Uge1xuICBzdGF0aWMgZ2V0IHRhYmxlTmFtZSgpIHtcbiAgICByZXR1cm4gJ2Zvcm1zJztcbiAgfVxuXG4gIHN0YXRpYyBnZXQgY29sdW1ucygpIHtcbiAgICByZXR1cm4gW1xuICAgICAgeyBuYW1lOiAnYWNjb3VudFJvd0lEJywgY29sdW1uOiAnYWNjb3VudF9pZCcsIHR5cGU6ICdpbnRlZ2VyJywgbnVsbDogZmFsc2UgfSxcbiAgICAgIHsgbmFtZTogJ2lkJywgY29sdW1uOiAncmVzb3VyY2VfaWQnLCB0eXBlOiAnc3RyaW5nJywgbnVsbDogZmFsc2UgfSxcbiAgICAgIHsgbmFtZTogJ25hbWUnLCBjb2x1bW46ICduYW1lJywgdHlwZTogJ3N0cmluZycsIG51bGw6IGZhbHNlIH0sXG4gICAgICB7IG5hbWU6ICd2ZXJzaW9uJywgY29sdW1uOiAndmVyc2lvbicsIHR5cGU6ICdpbnRlZ2VyJywgbnVsbDogZmFsc2UgfSxcbiAgICAgIHsgbmFtZTogJ2Rlc2NyaXB0aW9uJywgY29sdW1uOiAnZGVzY3JpcHRpb24nLCB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgeyBuYW1lOiAnZWxlbWVudHNKU09OJywgY29sdW1uOiAnZWxlbWVudHMnLCB0eXBlOiAnanNvbicsIG51bGw6IGZhbHNlIH0sXG4gICAgICB7IG5hbWU6ICd0aXRsZUZpZWxkS2V5c0pTT04nLCBjb2x1bW46ICd0aXRsZV9maWVsZF9rZXlzJywgdHlwZTogJ2pzb24nIH0sXG4gICAgICB7IG5hbWU6ICdzdGF0dXNGaWVsZEpTT04nLCBjb2x1bW46ICdzdGF0dXNfZmllbGQnLCB0eXBlOiAnanNvbicgfSxcbiAgICAgIHsgbmFtZTogJ2dlb21ldHJ5VHlwZXMnLCBjb2x1bW46ICdnZW9tZXRyeV90eXBlcycsIHR5cGU6ICdqc29uJyB9LFxuICAgICAgeyBuYW1lOiAnZ2VvbWV0cnlSZXF1aXJlZCcsIGNvbHVtbjogJ2dlb21ldHJ5X3JlcXVpcmVkJywgdHlwZTogJ2Jvb2xlYW4nIH0sXG4gICAgICB7IG5hbWU6ICdwcm9qZWN0RW5hYmxlZCcsIGNvbHVtbjogJ3Byb2plY3RzX2VuYWJsZWQnLCB0eXBlOiAnYm9vbGVhbicgfSxcbiAgICAgIHsgbmFtZTogJ2Fzc2lnbm1lbnRFbmFibGVkJywgY29sdW1uOiAnYXNzaWdubWVudF9lbmFibGVkJywgdHlwZTogJ2Jvb2xlYW4nIH0sXG4gICAgICB7IG5hbWU6ICdhdXRvQXNzaWduJywgY29sdW1uOiAnYXV0b19hc3NpZ24nLCB0eXBlOiAnYm9vbGVhbicgfSxcbiAgICAgIHsgbmFtZTogJ2hpZGRlbk9uRGFzaGJvYXJkJywgY29sdW1uOiAnaGlkZGVuX29uX2Rhc2hib2FyZCcsIHR5cGU6ICdib29sZWFuJyB9LFxuICAgICAgeyBuYW1lOiAnaW1hZ2UnLCBjb2x1bW46ICdpbWFnZScsIHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICB7IG5hbWU6ICdpbWFnZUxhcmdlJywgY29sdW1uOiAnaW1hZ2VfbGFyZ2UnLCB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgeyBuYW1lOiAnaW1hZ2VTbWFsbCcsIGNvbHVtbjogJ2ltYWdlX3NtYWxsJywgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgIHsgbmFtZTogJ2ltYWdlVGh1bWJuYWlsJywgY29sdW1uOiAnaW1hZ2VfdGh1bWJuYWlsJywgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgIHsgbmFtZTogJ2xhc3RTeW5jJywgY29sdW1uOiAnbGFzdF9zeW5jJywgdHlwZTogJ2RhdGV0aW1lJyB9LFxuICAgICAgeyBuYW1lOiAnc2NyaXB0JywgY29sdW1uOiAnc2NyaXB0JywgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgIHsgbmFtZTogJ2NyZWF0ZWRBdCcsIGNvbHVtbjogJ3NlcnZlcl9jcmVhdGVkX2F0JywgdHlwZTogJ2RhdGV0aW1lJyB9LFxuICAgICAgeyBuYW1lOiAndXBkYXRlZEF0JywgY29sdW1uOiAnc2VydmVyX3VwZGF0ZWRfYXQnLCB0eXBlOiAnZGF0ZXRpbWUnIH0sXG4gICAgICB7IG5hbWU6ICdkZWxldGVkQXQnLCBjb2x1bW46ICdkZWxldGVkX2F0JywgdHlwZTogJ2RhdGV0aW1lJyB9XG4gICAgXTtcbiAgfVxuXG4gIGZpbmRFYWNoUmVjb3JkKHdoZXJlLCBjYWxsYmFjaykge1xuICAgIHJldHVybiBSZWNvcmQuZmluZEVhY2godGhpcy5kYiwge3doZXJlOiB7Li4ud2hlcmUsIGZvcm1faWQ6IHRoaXMucm93SUR9fSwgY2FsbGJhY2spO1xuICB9XG5cbiAgYXN5bmMgZmluZFJlY29yZHNCeVNRTChzcWwsIHZhbHVlcykge1xuICAgIGNvbnN0IHRhYmxlTmFtZSA9IGBhY2NvdW50XyR7dGhpcy5fYWNjb3VudFJvd0lEfV9mb3JtXyR7dGhpcy5yb3dJRH1fdmlld19mdWxsYDtcblxuICAgIHNxbCA9ICdTRUxFQ1QgKiBGUk9NICcgKyB0YWJsZU5hbWUgKyAoc3FsID8gJyBXSEVSRSAnICsgc3FsIDogJycpO1xuXG4gICAgY29uc3Qgcm93cyA9IGF3YWl0IHRoaXMuZGIuYWxsKHNxbCwgdmFsdWVzKTtcblxuICAgIGNvbnN0IHJlY29yZHMgPSBbXTtcblxuICAgIGZvciAoY29uc3Qgcm93IG9mIHJvd3MpIHtcbiAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBSZWNvcmQucXVlcnlSb3dUb0F0dHJpYnV0ZXMocm93KTtcblxuICAgICAgY29uc3QgcmVjb3JkID0gbmV3IFJlY29yZChhdHRyaWJ1dGVzLCB0aGlzKTtcblxuICAgICAgcmVjb3JkLl9kYiA9IHRoaXMuZGI7XG5cbiAgICAgIHJlY29yZHMucHVzaChyZWNvcmQpO1xuICAgIH1cblxuICAgIHJldHVybiByZWNvcmRzO1xuICB9XG59XG5cblBlcnNpc3RlbnRPYmplY3QucmVnaXN0ZXIoRm9ybSk7XG4iXX0=