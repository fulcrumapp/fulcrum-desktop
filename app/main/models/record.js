"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _minidb = require("minidb");

var _fulcrumCore = require("fulcrum-core");

var _sqliteRecordValues = _interopRequireDefault(require("./record-values/sqlite-record-values"));

var _form = _interopRequireDefault(require("./form"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class Record extends _fulcrumCore.Record {
  static get tableName() {
    return 'records';
  }

  static get columns() {
    return [{
      name: 'accountRowID',
      column: 'account_id',
      type: 'integer',
      null: false
    }, {
      name: 'id',
      column: 'resource_id',
      type: 'string',
      null: false
    }, {
      name: 'formValuesJSON',
      column: 'form_values',
      type: 'json',
      null: false
    }, {
      name: 'clientCreatedAt',
      column: 'client_created_at',
      type: 'datetime'
    }, {
      name: 'clientUpdatedAt',
      column: 'client_updated_at',
      type: 'datetime'
    }, {
      name: 'createdAt',
      column: 'server_created_at',
      type: 'datetime'
    }, {
      name: 'updatedAt',
      column: 'server_updated_at',
      type: 'datetime'
    }, {
      name: 'status',
      column: 'status',
      type: 'string'
    }, {
      name: 'latitude',
      column: 'latitude',
      type: 'double'
    }, {
      name: 'longitude',
      column: 'longitude',
      type: 'double'
    }, {
      name: 'altitude',
      column: 'altitude',
      type: 'double'
    }, {
      name: 'speed',
      column: 'speed',
      type: 'double'
    }, {
      name: 'course',
      column: 'course',
      type: 'double'
    }, {
      name: 'horizontalAccuracy',
      column: 'horizontal_accuracy',
      type: 'double'
    }, {
      name: 'verticalAccuracy',
      column: 'vertical_accuracy',
      type: 'double'
    }, {
      name: 'formRowID',
      column: 'form_id',
      type: 'integer'
    }, {
      name: 'projectRowID',
      column: 'project_id',
      type: 'integer'
    }, {
      name: 'projectID',
      column: 'project_resource_id',
      type: 'string'
    }, {
      name: 'assignedToRowID',
      column: 'assigned_to_id',
      type: 'integer'
    }, {
      name: 'assignedToID',
      column: 'assigned_to_resource_id',
      type: 'string'
    }, {
      name: 'updatedByRowID',
      column: 'updated_by_id',
      type: 'integer'
    }, {
      name: 'updatedByID',
      column: 'updated_by_resource_id',
      type: 'string'
    }, {
      name: 'createdByRowID',
      column: 'created_by_id',
      type: 'integer'
    }, {
      name: 'createdByID',
      column: 'created_by_resource_id',
      type: 'string'
    }, {
      name: 'changesetRowID',
      column: 'changeset_id',
      type: 'integer'
    }, {
      name: 'changesetID',
      column: 'changeset_resource_id',
      type: 'string'
    }, {
      name: 'version',
      column: 'version',
      type: 'integer',
      null: false
    }, {
      name: 'hasChanges',
      column: 'has_changes',
      type: 'boolean'
    }, {
      name: 'draft',
      column: 'draft',
      type: 'boolean',
      null: false
    }, {
      name: 'isNew',
      column: 'is_new',
      type: 'boolean',
      null: false
    }, {
      name: 'lastError',
      column: 'last_error',
      type: 'string'
    }, {
      name: 'indexText',
      column: 'index_text',
      type: 'string'
    }, {
      name: 'title',
      column: 'title',
      type: 'string'
    }, {
      name: 'createdDuration',
      column: 'created_duration',
      type: 'integer'
    }, {
      name: 'updatedDuration',
      column: 'updated_duration',
      type: 'integer'
    }, {
      name: 'editedDuration',
      column: 'edited_duration',
      type: 'integer'
    }, {
      name: 'updatedLatitude',
      column: 'updated_latitude',
      type: 'double'
    }, {
      name: 'updatedLongitude',
      column: 'updated_longitude',
      type: 'double'
    }, {
      name: 'updatedAltitude',
      column: 'updated_altitude',
      type: 'double'
    }, {
      name: 'updatedAccuracy',
      column: 'updated_accuracy',
      type: 'double'
    }, {
      name: 'createdLatitude',
      column: 'created_latitude',
      type: 'double'
    }, {
      name: 'createdLongitude',
      column: 'created_longitude',
      type: 'double'
    }, {
      name: 'createdAltitude',
      column: 'created_altitude',
      type: 'double'
    }, {
      name: 'createdAccuracy',
      column: 'created_accuracy',
      type: 'double'
    }];
  }

  databaseValues(db) {
    const values = _minidb.PersistentObject.prototype.databaseValues.call(this);

    if (values.has_changes == null) {
      values.has_changes = false;
    }

    if (values.draft == null) {
      values.draft = false;
    }

    if (values.is_new == null) {
      values.is_new = false;
    }

    values.title = this.displayValue;
    return values;
  }

  get recordValueOptions() {
    return {
      escapeIdentifier: value => this.db.ident(value),
      accountPrefix: 'account_' + this.accountRowID
    };
  }

  async afterSave(options) {
    const statements = _sqliteRecordValues.default.updateForRecordStatements(this.db, this, this.recordValueOptions);

    await this.db.execute(statements.map(o => o.sql).join('\n'));
  }

  async beforeSave(options) {
    this._indexText = this.formValues.searchableValue;
  }

  async beforeDelete(options) {
    const statements = _sqliteRecordValues.default.deleteForRecordStatements(this.db, this, this.form, this.recordValueOptions);

    await this.db.execute(statements.map(o => o.sql).join('\n'));
  }

  getForm() {
    return this.loadOne('form', _form.default);
  }

  get form() {
    return this._form;
  }

  set form(form) {
    this.setOne('form', form);
  }

  static queryRowToAttributes(row) {
    const attributes = {
      id: row._record_id,
      project_id: row._project_id,
      assigned_to_id: row._assigned_to_id,
      status: row._status,
      latitude: row._latitude,
      longitude: row._longitude,
      client_created_at: new Date(row._created_at),
      client_updated_at: new Date(row._updated_at),
      version: row._version,
      created_by_id: row._created_by_id,
      updated_by_id: row._updated_by_id,
      created_at: new Date(row._server_created_at),
      updated_at: new Date(row._server_updated_at),
      altitude: row._altitude,
      speed: row._speed,
      course: row._course,
      horizontal_accuracy: row._horizontal_accuracy,
      vertical_accuracy: row._vertical_accuracy,
      form_values: JSON.parse(row._form_values),
      changeset_id: row._changeset_id,
      created_latitude: row._created_latitude,
      created_longitude: row._created_longitude,
      created_geometry: row._created_geometry,
      created_altitude: row._created_altitude,
      created_horizontal_accuracy: row._created_horizontal_accuracy,
      updated_latitude: row._updated_latitude,
      updated_longitude: row._updated_longitude,
      updated_geometry: row._updated_geometry,
      updated_altitude: row._updated_altitude,
      updated_horizontal_accuracy: row._updated_horizontal_accuracy,
      created_duration: row._created_duration,
      updated_duration: row._updated_duration,
      edited_duration: row._edited_duration
    };
    return attributes;
  }

}

exports.default = Record;

_minidb.PersistentObject.register(Record);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tYWluL21vZGVscy9yZWNvcmQuanMiXSwibmFtZXMiOlsiUmVjb3JkIiwiUmVjb3JkQmFzZSIsInRhYmxlTmFtZSIsImNvbHVtbnMiLCJuYW1lIiwiY29sdW1uIiwidHlwZSIsIm51bGwiLCJkYXRhYmFzZVZhbHVlcyIsImRiIiwidmFsdWVzIiwiUGVyc2lzdGVudE9iamVjdCIsInByb3RvdHlwZSIsImNhbGwiLCJoYXNfY2hhbmdlcyIsImRyYWZ0IiwiaXNfbmV3IiwidGl0bGUiLCJkaXNwbGF5VmFsdWUiLCJyZWNvcmRWYWx1ZU9wdGlvbnMiLCJlc2NhcGVJZGVudGlmaWVyIiwidmFsdWUiLCJpZGVudCIsImFjY291bnRQcmVmaXgiLCJhY2NvdW50Um93SUQiLCJhZnRlclNhdmUiLCJvcHRpb25zIiwic3RhdGVtZW50cyIsIlNRTGl0ZVJlY29yZFZhbHVlcyIsInVwZGF0ZUZvclJlY29yZFN0YXRlbWVudHMiLCJleGVjdXRlIiwibWFwIiwibyIsInNxbCIsImpvaW4iLCJiZWZvcmVTYXZlIiwiX2luZGV4VGV4dCIsImZvcm1WYWx1ZXMiLCJzZWFyY2hhYmxlVmFsdWUiLCJiZWZvcmVEZWxldGUiLCJkZWxldGVGb3JSZWNvcmRTdGF0ZW1lbnRzIiwiZm9ybSIsImdldEZvcm0iLCJsb2FkT25lIiwiRm9ybSIsIl9mb3JtIiwic2V0T25lIiwicXVlcnlSb3dUb0F0dHJpYnV0ZXMiLCJyb3ciLCJhdHRyaWJ1dGVzIiwiaWQiLCJfcmVjb3JkX2lkIiwicHJvamVjdF9pZCIsIl9wcm9qZWN0X2lkIiwiYXNzaWduZWRfdG9faWQiLCJfYXNzaWduZWRfdG9faWQiLCJzdGF0dXMiLCJfc3RhdHVzIiwibGF0aXR1ZGUiLCJfbGF0aXR1ZGUiLCJsb25naXR1ZGUiLCJfbG9uZ2l0dWRlIiwiY2xpZW50X2NyZWF0ZWRfYXQiLCJEYXRlIiwiX2NyZWF0ZWRfYXQiLCJjbGllbnRfdXBkYXRlZF9hdCIsIl91cGRhdGVkX2F0IiwidmVyc2lvbiIsIl92ZXJzaW9uIiwiY3JlYXRlZF9ieV9pZCIsIl9jcmVhdGVkX2J5X2lkIiwidXBkYXRlZF9ieV9pZCIsIl91cGRhdGVkX2J5X2lkIiwiY3JlYXRlZF9hdCIsIl9zZXJ2ZXJfY3JlYXRlZF9hdCIsInVwZGF0ZWRfYXQiLCJfc2VydmVyX3VwZGF0ZWRfYXQiLCJhbHRpdHVkZSIsIl9hbHRpdHVkZSIsInNwZWVkIiwiX3NwZWVkIiwiY291cnNlIiwiX2NvdXJzZSIsImhvcml6b250YWxfYWNjdXJhY3kiLCJfaG9yaXpvbnRhbF9hY2N1cmFjeSIsInZlcnRpY2FsX2FjY3VyYWN5IiwiX3ZlcnRpY2FsX2FjY3VyYWN5IiwiZm9ybV92YWx1ZXMiLCJKU09OIiwicGFyc2UiLCJfZm9ybV92YWx1ZXMiLCJjaGFuZ2VzZXRfaWQiLCJfY2hhbmdlc2V0X2lkIiwiY3JlYXRlZF9sYXRpdHVkZSIsIl9jcmVhdGVkX2xhdGl0dWRlIiwiY3JlYXRlZF9sb25naXR1ZGUiLCJfY3JlYXRlZF9sb25naXR1ZGUiLCJjcmVhdGVkX2dlb21ldHJ5IiwiX2NyZWF0ZWRfZ2VvbWV0cnkiLCJjcmVhdGVkX2FsdGl0dWRlIiwiX2NyZWF0ZWRfYWx0aXR1ZGUiLCJjcmVhdGVkX2hvcml6b250YWxfYWNjdXJhY3kiLCJfY3JlYXRlZF9ob3Jpem9udGFsX2FjY3VyYWN5IiwidXBkYXRlZF9sYXRpdHVkZSIsIl91cGRhdGVkX2xhdGl0dWRlIiwidXBkYXRlZF9sb25naXR1ZGUiLCJfdXBkYXRlZF9sb25naXR1ZGUiLCJ1cGRhdGVkX2dlb21ldHJ5IiwiX3VwZGF0ZWRfZ2VvbWV0cnkiLCJ1cGRhdGVkX2FsdGl0dWRlIiwiX3VwZGF0ZWRfYWx0aXR1ZGUiLCJ1cGRhdGVkX2hvcml6b250YWxfYWNjdXJhY3kiLCJfdXBkYXRlZF9ob3Jpem9udGFsX2FjY3VyYWN5IiwiY3JlYXRlZF9kdXJhdGlvbiIsIl9jcmVhdGVkX2R1cmF0aW9uIiwidXBkYXRlZF9kdXJhdGlvbiIsIl91cGRhdGVkX2R1cmF0aW9uIiwiZWRpdGVkX2R1cmF0aW9uIiwiX2Vk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TSxFQUFFLGtCQUFuQztBQUF1REMsTUFBQUEsSUFBSSxFQUFFO0FBQTdELEtBbENLLEVBbUNMO0FBQUVGLE1BQUFBLElBQUksRUFBRSxpQkFBUjtBQUEyQkMsTUFBQUEsTUFBTSxFQUFFLGtCQUFuQztBQUF1REMsTUFBQUEsSUFBSSxFQUFFO0FBQTdELEtBbkNLLEVBb0NMO0FBQUVGLE1BQUFBLElBQUksRUFBRSxnQkFBUjtBQUEwQkMsTUFBQUEsTUFBTSxFQUFFLGlCQUFsQztBQUFxREMsTUFBQUEsSUFBSSxFQUFFO0FBQTNELEtBcENLLEVBcUNMO0FBQUVGLE1BQUFBLElBQUksRUFBRSxpQkFBUjtBQUEyQkMsTUFBQUEsTUFBTSxFQUFFLGtCQUFuQztBQUF1REMsTUFBQUEsSUFBSSxFQUFFO0FBQTdELEtBckNLLEVBc0NMO0FBQUVGLE1BQUFBLElBQUksRUFBRSxrQkFBUjtBQUE0QkMsTUFBQUEsTUFBTSxFQUFFLG1CQUFwQztBQUF5REMsTUFBQUEsSUFBSSxFQUFFO0FBQS9ELEtBdENLLEVBdUNMO0FBQUVGLE1BQUFBLElBQUksRUFBRSxpQkFBUjtBQUEyQkMsTUFBQUEsTUFBTSxFQUFFLGtCQUFuQztBQUF1REMsTUFBQUEsSUFBSSxFQUFFO0FBQTdELEtBdkNLLEVBd0NMO0FBQUVGLE1BQUFBLElBQUksRUFBRSxpQkFBUjtBQUEyQkMsTUFBQUEsTUFBTSxFQUFFLGtCQUFuQztBQUF1REMsTUFBQUEsSUFBSSxFQUFFO0FBQTdELEtBeENLLEVBeUNMO0FBQUVGLE1BQUFBLElBQUksRUFBRSxpQkFBUjtBQUEyQkMsTUFBQUEsTUFBTSxFQUFFLGtCQUFuQztBQUF1REMsTUFBQUEsSUFBSSxFQUFFO0FBQTdELEtBekNLLEVBMENMO0FBQUVGLE1BQUFBLElBQUksRUFBRSxrQkFBUjtBQUE0QkMsTUFBQUEsTUFBTSxFQUFFLG1CQUFwQztBQUF5REMsTUFBQUEsSUFBSSxFQUFFO0FBQS9ELEtBMUNLLEVBMkNMO0FBQUVGLE1BQUFBLElBQUksRUFBRSxpQkFBUjtBQUEyQkMsTUFBQUEsTUFBTSxFQUFFLGtCQUFuQztBQUF1REMsTUFBQUEsSUFBSSxFQUFFO0FBQTdELEtBM0NLLEVBNENMO0FBQUVGLE1BQUFBLElBQUksRUFBRSxpQkFBUjtBQUEyQkMsTUFBQUEsTUFBTSxFQUFFLGtCQUFuQztBQUF1REMsTUFBQUEsSUFBSSxFQUFFO0FBQTdELEtBNUNLLENBQVA7QUE4Q0Q7O0FBRURFLEVBQUFBLGNBQWMsQ0FBQ0MsRUFBRCxFQUFLO0FBQ2pCLFVBQU1DLE1BQU0sR0FBR0MseUJBQWlCQyxTQUFqQixDQUEyQkosY0FBM0IsQ0FBMENLLElBQTFDLENBQStDLElBQS9DLENBQWY7O0FBRUEsUUFBSUgsTUFBTSxDQUFDSSxXQUFQLElBQXNCLElBQTFCLEVBQWdDO0FBQzlCSixNQUFBQSxNQUFNLENBQUNJLFdBQVAsR0FBcUIsS0FBckI7QUFDRDs7QUFFRCxRQUFJSixNQUFNLENBQUNLLEtBQVAsSUFBZ0IsSUFBcEIsRUFBMEI7QUFDeEJMLE1BQUFBLE1BQU0sQ0FBQ0ssS0FBUCxHQUFlLEtBQWY7QUFDRDs7QUFFRCxRQUFJTCxNQUFNLENBQUNNLE1BQVAsSUFBaUIsSUFBckIsRUFBMkI7QUFDekJOLE1BQUFBLE1BQU0sQ0FBQ00sTUFBUCxHQUFnQixLQUFoQjtBQUNEOztBQUVETixJQUFBQSxNQUFNLENBQUNPLEtBQVAsR0FBZSxLQUFLQyxZQUFwQjtBQUVBLFdBQU9SLE1BQVA7QUFDRDs7QUFFcUIsTUFBbEJTLGtCQUFrQixHQUFHO0FBQ3ZCLFdBQU87QUFDTEMsTUFBQUEsZ0JBQWdCLEVBQUdDLEtBQUQsSUFBVyxLQUFLWixFQUFMLENBQVFhLEtBQVIsQ0FBY0QsS0FBZCxDQUR4QjtBQUVMRSxNQUFBQSxhQUFhLEVBQUUsYUFBYSxLQUFLQztBQUY1QixLQUFQO0FBSUQ7O0FBRWMsUUFBVEMsU0FBUyxDQUFDQyxPQUFELEVBQVU7QUFDdkIsVUFBTUMsVUFBVSxHQUFHQyw0QkFBbUJDLHlCQUFuQixDQUE2QyxLQUFLcEIsRUFBbEQsRUFBc0QsSUFBdEQsRUFBNEQsS0FBS1Usa0JBQWpFLENBQW5COztBQUVBLFVBQU0sS0FBS1YsRUFBTCxDQUFRcUIsT0FBUixDQUFnQkgsVUFBVSxDQUFDSSxHQUFYLENBQWVDLENBQUMsSUFBSUEsQ0FBQyxDQUFDQyxHQUF0QixFQUEyQkMsSUFBM0IsQ0FBZ0MsSUFBaEMsQ0FBaEIsQ0FBTjtBQUNEOztBQUVlLFFBQVZDLFVBQVUsQ0FBQ1QsT0FBRCxFQUFVO0FBQ3hCLFNBQUtVLFVBQUwsR0FBa0IsS0FBS0MsVUFBTCxDQUFnQkMsZUFBbEM7QUFDRDs7QUFFaUIsUUFBWkMsWUFBWSxDQUFDYixPQUFELEVBQVU7QUFDMUIsVUFBTUMsVUFBVSxHQUFHQyw0QkFBbUJZLHlCQUFuQixDQUE2QyxLQUFLL0IsRUFBbEQsRUFBc0QsSUFBdEQsRUFBNEQsS0FBS2dDLElBQWpFLEVBQXVFLEtBQUt0QixrQkFBNUUsQ0FBbkI7O0FBRUEsVUFBTSxLQUFLVixFQUFMLENBQVFxQixPQUFSLENBQWdCSCxVQUFVLENBQUNJLEdBQVgsQ0FBZUMsQ0FBQyxJQUFJQSxDQUFDLENBQUNDLEdBQXRCLEVBQTJCQyxJQUEzQixDQUFnQyxJQUFoQyxDQUFoQixDQUFOO0FBQ0Q7O0FBRURRLEVBQUFBLE9BQU8sR0FBRztBQUNSLFdBQU8sS0FBS0MsT0FBTCxDQUFhLE1BQWIsRUFBcUJDLGFBQXJCLENBQVA7QUFDRDs7QUFFTyxNQUFKSCxJQUFJLEdBQUc7QUFDVCxXQUFPLEtBQUtJLEtBQVo7QUFDRDs7QUFFTyxNQUFKSixJQUFJLENBQUNBLElBQUQsRUFBTztBQUNiLFNBQUtLLE1BQUwsQ0FBWSxNQUFaLEVBQW9CTCxJQUFwQjtBQUNEOztBQUUwQixTQUFwQk0sb0JBQW9CLENBQUNDLEdBQUQsRUFBTTtBQUMvQixVQUFNQyxVQUFVLEdBQUc7QUFDakJDLE1BQUFBLEVBQUUsRUFBRUYsR0FBRyxDQUFDRyxVQURTO0FBRWpCQyxNQUFBQSxVQUFVLEVBQUVKLEdBQUcsQ0FBQ0ssV0FGQztBQUdqQkMsTUFBQUEsY0FBYyxFQUFFTixHQUFHLENBQUNPLGVBSEg7QUFJakJDLE1BQUFBLE1BQU0sRUFBRVIsR0FBRyxDQUFDUyxPQUpLO0FBS2pCQyxNQUFBQSxRQUFRLEVBQUVWLEdBQUcsQ0FBQ1csU0FMRztBQU1qQkMsTUFBQUEsU0FBUyxFQUFFWixHQUFHLENBQUNhLFVBTkU7QUFPakJDLE1BQUFBLGlCQUFpQixFQUFFLElBQUlDLElBQUosQ0FBU2YsR0FBRyxDQUFDZ0IsV0FBYixDQVBGO0FBUWpCQyxNQUFBQSxpQkFBaUIsRUFBRSxJQUFJRixJQUFKLENBQVNmLEdBQUcsQ0FBQ2tCLFdBQWIsQ0FSRjtBQVNqQkMsTUFBQUEsT0FBTyxFQUFFbkIsR0FBRyxDQUFDb0IsUUFUSTtBQVVqQkMsTUFBQUEsYUFBYSxFQUFFckIsR0FBRyxDQUFDc0IsY0FWRjtBQVdqQkMsTUFBQUEsYUFBYSxFQUFFdkIsR0FBRyxDQUFDd0IsY0FYRjtBQVlqQkMsTUFBQUEsVUFBVSxFQUFFLElBQUlWLElBQUosQ0FBU2YsR0FBRyxDQUFDMEIsa0JBQWIsQ0FaSztBQWFqQkMsTUFBQUEsVUFBVSxFQUFFLElBQUlaLElBQUosQ0FBU2YsR0FBRyxDQUFDNEIsa0JBQWIsQ0FiSztBQWNqQkMsTUFBQUEsUUFBUSxFQUFFN0IsR0FBRyxDQUFDOEIsU0FkRztBQWVqQkMsTUFBQUEsS0FBSyxFQUFFL0IsR0FBRyxDQUFDZ0MsTUFmTTtBQWdCakJDLE1BQUFBLE1BQU0sRUFBRWpDLEdBQUcsQ0FBQ2tDLE9BaEJLO0FBaUJqQkMsTUFBQUEsbUJBQW1CLEVBQUVuQyxHQUFHLENBQUNvQyxvQkFqQlI7QUFrQmpCQyxNQUFBQSxpQkFBaUIsRUFBRXJDLEdBQUcsQ0FBQ3NDLGtCQWxCTjtBQW1CakJDLE1BQUFBLFdBQVcsRUFBRUMsSUFBSSxDQUFDQyxLQUFMLENBQVd6QyxHQUFHLENBQUMwQyxZQUFmLENBbkJJO0FBb0JqQkMsTUFBQUEsWUFBWSxFQUFFM0MsR0FBRyxDQUFDNEMsYUFwQkQ7QUFxQmpCQyxNQUFBQSxnQkFBZ0IsRUFBRTdDLEdBQUcsQ0FBQzhDLGlCQXJCTDtBQXNCakJDLE1BQUFBLGlCQUFpQixFQUFFL0MsR0FBRyxDQUFDZ0Qsa0JBdEJOO0FBdUJqQkMsTUFBQUEsZ0JBQWdCLEVBQUVqRCxHQUFHLENBQUNrRCxpQkF2Qkw7QUF3QmpCQyxNQUFBQSxnQkFBZ0IsRUFBRW5ELEdBQUcsQ0FBQ29ELGlCQXhCTDtBQXlCakJDLE1BQUFBLDJCQUEyQixFQUFFckQsR0FBRyxDQUFDc0QsNEJBekJoQjtBQTBCakJDLE1BQUFBLGdCQUFnQixFQUFFdkQsR0FBRyxDQUFDd0QsaUJBMUJMO0FBMkJqQkMsTUFBQUEsaUJBQWlCLEVBQUV6RCxHQUFHLENBQUMwRCxrQkEzQk47QUE0QmpCQyxNQUFBQSxnQkFBZ0IsRUFBRTNELEdBQUcsQ0FBQzRELGlCQTVCTDtBQTZCakJDLE1BQUFBLGdCQUFnQixFQUFFN0QsR0FBRyxDQUFDOEQsaUJBN0JMO0FBOEJqQkMsTUFBQUEsMkJBQTJCLEVBQUUvRCxHQUFHLENBQUNnRSw0QkE5QmhCO0FBK0JqQkMsTUFBQUEsZ0JBQWdCLEVBQUVqRSxHQUFHLENBQUNrRSxpQkEvQkw7QUFnQ2pCQyxNQUFBQSxnQkFBZ0IsRUFBRW5FLEdBQUcsQ0FBQ29FLGlCQWhDTDtBQWlDakJDLE1BQUFBLGVBQWUsRUFBRXJFLEdBQUcsQ0FBQ3NFO0FBakNKLEtBQW5CO0FBb0NBLFdBQU9yRSxVQUFQO0FBQ0Q7O0FBbko0Qzs7OztBQXNKL0N0Qyx5QkFBaUI0RyxRQUFqQixDQUEwQnZILE1BQTFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGVyc2lzdGVudE9iamVjdCB9IGZyb20gJ21pbmlkYic7XG5pbXBvcnQgeyBSZWNvcmQgYXMgUmVjb3JkQmFzZSB9IGZyb20gJ2Z1bGNydW0tY29yZSc7XG5pbXBvcnQgU1FMaXRlUmVjb3JkVmFsdWVzIGZyb20gJy4vcmVjb3JkLXZhbHVlcy9zcWxpdGUtcmVjb3JkLXZhbHVlcyc7XG5pbXBvcnQgRm9ybSBmcm9tICcuL2Zvcm0nO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSZWNvcmQgZXh0ZW5kcyBSZWNvcmRCYXNlIHtcbiAgc3RhdGljIGdldCB0YWJsZU5hbWUoKSB7XG4gICAgcmV0dXJuICdyZWNvcmRzJztcbiAgfVxuXG4gIHN0YXRpYyBnZXQgY29sdW1ucygpIHtcbiAgICByZXR1cm4gW1xuICAgICAgeyBuYW1lOiAnYWNjb3VudFJvd0lEJywgY29sdW1uOiAnYWNjb3VudF9pZCcsIHR5cGU6ICdpbnRlZ2VyJywgbnVsbDogZmFsc2UgfSxcbiAgICAgIHsgbmFtZTogJ2lkJywgY29sdW1uOiAncmVzb3VyY2VfaWQnLCB0eXBlOiAnc3RyaW5nJywgbnVsbDogZmFsc2UgfSxcbiAgICAgIHsgbmFtZTogJ2Zvcm1WYWx1ZXNKU09OJywgY29sdW1uOiAnZm9ybV92YWx1ZXMnLCB0eXBlOiAnanNvbicsIG51bGw6IGZhbHNlIH0sXG4gICAgICB7IG5hbWU6ICdjbGllbnRDcmVhdGVkQXQnLCBjb2x1bW46ICdjbGllbnRfY3JlYXRlZF9hdCcsIHR5cGU6ICdkYXRldGltZScgfSxcbiAgICAgIHsgbmFtZTogJ2NsaWVudFVwZGF0ZWRBdCcsIGNvbHVtbjogJ2NsaWVudF91cGRhdGVkX2F0JywgdHlwZTogJ2RhdGV0aW1lJyB9LFxuICAgICAgeyBuYW1lOiAnY3JlYXRlZEF0JywgY29sdW1uOiAnc2VydmVyX2NyZWF0ZWRfYXQnLCB0eXBlOiAnZGF0ZXRpbWUnIH0sXG4gICAgICB7IG5hbWU6ICd1cGRhdGVkQXQnLCBjb2x1bW46ICdzZXJ2ZXJfdXBkYXRlZF9hdCcsIHR5cGU6ICdkYXRldGltZScgfSxcbiAgICAgIHsgbmFtZTogJ3N0YXR1cycsIGNvbHVtbjogJ3N0YXR1cycsIHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICB7IG5hbWU6ICdsYXRpdHVkZScsIGNvbHVtbjogJ2xhdGl0dWRlJywgdHlwZTogJ2RvdWJsZScgfSxcbiAgICAgIHsgbmFtZTogJ2xvbmdpdHVkZScsIGNvbHVtbjogJ2xvbmdpdHVkZScsIHR5cGU6ICdkb3VibGUnIH0sXG4gICAgICB7IG5hbWU6ICdhbHRpdHVkZScsIGNvbHVtbjogJ2FsdGl0dWRlJywgdHlwZTogJ2RvdWJsZScgfSxcbiAgICAgIHsgbmFtZTogJ3NwZWVkJywgY29sdW1uOiAnc3BlZWQnLCB0eXBlOiAnZG91YmxlJyB9LFxuICAgICAgeyBuYW1lOiAnY291cnNlJywgY29sdW1uOiAnY291cnNlJywgdHlwZTogJ2RvdWJsZScgfSxcbiAgICAgIHsgbmFtZTogJ2hvcml6b250YWxBY2N1cmFjeScsIGNvbHVtbjogJ2hvcml6b250YWxfYWNjdXJhY3knLCB0eXBlOiAnZG91YmxlJyB9LFxuICAgICAgeyBuYW1lOiAndmVydGljYWxBY2N1cmFjeScsIGNvbHVtbjogJ3ZlcnRpY2FsX2FjY3VyYWN5JywgdHlwZTogJ2RvdWJsZScgfSxcbiAgICAgIHsgbmFtZTogJ2Zvcm1Sb3dJRCcsIGNvbHVtbjogJ2Zvcm1faWQnLCB0eXBlOiAnaW50ZWdlcicgfSxcbiAgICAgIHsgbmFtZTogJ3Byb2plY3RSb3dJRCcsIGNvbHVtbjogJ3Byb2plY3RfaWQnLCB0eXBlOiAnaW50ZWdlcicgfSxcbiAgICAgIHsgbmFtZTogJ3Byb2plY3RJRCcsIGNvbHVtbjogJ3Byb2plY3RfcmVzb3VyY2VfaWQnLCB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgeyBuYW1lOiAnYXNzaWduZWRUb1Jvd0lEJywgY29sdW1uOiAnYXNzaWduZWRfdG9faWQnLCB0eXBlOiAnaW50ZWdlcicgfSxcbiAgICAgIHsgbmFtZTogJ2Fzc2lnbmVkVG9JRCcsIGNvbHVtbjogJ2Fzc2lnbmVkX3RvX3Jlc291cmNlX2lkJywgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgIHsgbmFtZTogJ3VwZGF0ZWRCeVJvd0lEJywgY29sdW1uOiAndXBkYXRlZF9ieV9pZCcsIHR5cGU6ICdpbnRlZ2VyJyB9LFxuICAgICAgeyBuYW1lOiAndXBkYXRlZEJ5SUQnLCBjb2x1bW46ICd1cGRhdGVkX2J5X3Jlc291cmNlX2lkJywgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgIHsgbmFtZTogJ2NyZWF0ZWRCeVJvd0lEJywgY29sdW1uOiAnY3JlYXRlZF9ieV9pZCcsIHR5cGU6ICdpbnRlZ2VyJyB9LFxuICAgICAgeyBuYW1lOiAnY3JlYXRlZEJ5SUQnLCBjb2x1bW46ICdjcmVhdGVkX2J5X3Jlc291cmNlX2lkJywgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgIHsgbmFtZTogJ2NoYW5nZXNldFJvd0lEJywgY29sdW1uOiAnY2hhbmdlc2V0X2lkJywgdHlwZTogJ2ludGVnZXInIH0sXG4gICAgICB7IG5hbWU6ICdjaGFuZ2VzZXRJRCcsIGNvbHVtbjogJ2NoYW5nZXNldF9yZXNvdXJjZV9pZCcsIHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICB7IG5hbWU6ICd2ZXJzaW9uJywgY29sdW1uOiAndmVyc2lvbicsIHR5cGU6ICdpbnRlZ2VyJywgbnVsbDogZmFsc2UgfSxcbiAgICAgIHsgbmFtZTogJ2hhc0NoYW5nZXMnLCBjb2x1bW46ICdoYXNfY2hhbmdlcycsIHR5cGU6ICdib29sZWFuJyB9LFxuICAgICAgeyBuYW1lOiAnZHJhZnQnLCBjb2x1bW46ICdkcmFmdCcsIHR5cGU6ICdib29sZWFuJywgbnVsbDogZmFsc2UgfSxcbiAgICAgIHsgbmFtZTogJ2lzTmV3JywgY29sdW1uOiAnaXNfbmV3JywgdHlwZTogJ2Jvb2xlYW4nLCBudWxsOiBmYWxzZSB9LFxuICAgICAgeyBuYW1lOiAnbGFzdEVycm9yJywgY29sdW1uOiAnbGFzdF9lcnJvcicsIHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICB7IG5hbWU6ICdpbmRleFRleHQnLCBjb2x1bW46ICdpbmRleF90ZXh0JywgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgIHsgbmFtZTogJ3RpdGxlJywgY29sdW1uOiAndGl0bGUnLCB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgeyBuYW1lOiAnY3JlYXRlZER1cmF0aW9uJywgY29sdW1uOiAnY3JlYXRlZF9kdXJhdGlvbicsIHR5cGU6ICdpbnRlZ2VyJyB9LFxuICAgICAgeyBuYW1lOiAndXBkYXRlZER1cmF0aW9uJywgY29sdW1uOiAndXBkYXRlZF9kdXJhdGlvbicsIHR5cGU6ICdpbnRlZ2VyJyB9LFxuICAgICAgeyBuYW1lOiAnZWRpdGVkRHVyYXRpb24nLCBjb2x1bW46ICdlZGl0ZWRfZHVyYXRpb24nLCB0eXBlOiAnaW50ZWdlcicgfSxcbiAgICAgIHsgbmFtZTogJ3VwZGF0ZWRMYXRpdHVkZScsIGNvbHVtbjogJ3VwZGF0ZWRfbGF0aXR1ZGUnLCB0eXBlOiAnZG91YmxlJyB9LFxuICAgICAgeyBuYW1lOiAndXBkYXRlZExvbmdpdHVkZScsIGNvbHVtbjogJ3VwZGF0ZWRfbG9uZ2l0dWRlJywgdHlwZTogJ2RvdWJsZScgfSxcbiAgICAgIHsgbmFtZTogJ3VwZGF0ZWRBbHRpdHVkZScsIGNvbHVtbjogJ3VwZGF0ZWRfYWx0aXR1ZGUnLCB0eXBlOiAnZG91YmxlJyB9LFxuICAgICAgeyBuYW1lOiAndXBkYXRlZEFjY3VyYWN5JywgY29sdW1uOiAndXBkYXRlZF9hY2N1cmFjeScsIHR5cGU6ICdkb3VibGUnIH0sXG4gICAgICB7IG5hbWU6ICdjcmVhdGVkTGF0aXR1ZGUnLCBjb2x1bW46ICdjcmVhdGVkX2xhdGl0dWRlJywgdHlwZTogJ2RvdWJsZScgfSxcbiAgICAgIHsgbmFtZTogJ2NyZWF0ZWRMb25naXR1ZGUnLCBjb2x1bW46ICdjcmVhdGVkX2xvbmdpdHVkZScsIHR5cGU6ICdkb3VibGUnIH0sXG4gICAgICB7IG5hbWU6ICdjcmVhdGVkQWx0aXR1ZGUnLCBjb2x1bW46ICdjcmVhdGVkX2FsdGl0dWRlJywgdHlwZTogJ2RvdWJsZScgfSxcbiAgICAgIHsgbmFtZTogJ2NyZWF0ZWRBY2N1cmFjeScsIGNvbHVtbjogJ2NyZWF0ZWRfYWNjdXJhY3knLCB0eXBlOiAnZG91YmxlJyB9XG4gICAgXTtcbiAgfVxuXG4gIGRhdGFiYXNlVmFsdWVzKGRiKSB7XG4gICAgY29uc3QgdmFsdWVzID0gUGVyc2lzdGVudE9iamVjdC5wcm90b3R5cGUuZGF0YWJhc2VWYWx1ZXMuY2FsbCh0aGlzKTtcblxuICAgIGlmICh2YWx1ZXMuaGFzX2NoYW5nZXMgPT0gbnVsbCkge1xuICAgICAgdmFsdWVzLmhhc19jaGFuZ2VzID0gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKHZhbHVlcy5kcmFmdCA9PSBudWxsKSB7XG4gICAgICB2YWx1ZXMuZHJhZnQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAodmFsdWVzLmlzX25ldyA9PSBudWxsKSB7XG4gICAgICB2YWx1ZXMuaXNfbmV3ID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdmFsdWVzLnRpdGxlID0gdGhpcy5kaXNwbGF5VmFsdWU7XG5cbiAgICByZXR1cm4gdmFsdWVzO1xuICB9XG5cbiAgZ2V0IHJlY29yZFZhbHVlT3B0aW9ucygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZXNjYXBlSWRlbnRpZmllcjogKHZhbHVlKSA9PiB0aGlzLmRiLmlkZW50KHZhbHVlKSxcbiAgICAgIGFjY291bnRQcmVmaXg6ICdhY2NvdW50XycgKyB0aGlzLmFjY291bnRSb3dJRFxuICAgIH07XG4gIH1cblxuICBhc3luYyBhZnRlclNhdmUob3B0aW9ucykge1xuICAgIGNvbnN0IHN0YXRlbWVudHMgPSBTUUxpdGVSZWNvcmRWYWx1ZXMudXBkYXRlRm9yUmVjb3JkU3RhdGVtZW50cyh0aGlzLmRiLCB0aGlzLCB0aGlzLnJlY29yZFZhbHVlT3B0aW9ucyk7XG5cbiAgICBhd2FpdCB0aGlzLmRiLmV4ZWN1dGUoc3RhdGVtZW50cy5tYXAobyA9PiBvLnNxbCkuam9pbignXFxuJykpO1xuICB9XG5cbiAgYXN5bmMgYmVmb3JlU2F2ZShvcHRpb25zKSB7XG4gICAgdGhpcy5faW5kZXhUZXh0ID0gdGhpcy5mb3JtVmFsdWVzLnNlYXJjaGFibGVWYWx1ZTtcbiAgfVxuXG4gIGFzeW5jIGJlZm9yZURlbGV0ZShvcHRpb25zKSB7XG4gICAgY29uc3Qgc3RhdGVtZW50cyA9IFNRTGl0ZVJlY29yZFZhbHVlcy5kZWxldGVGb3JSZWNvcmRTdGF0ZW1lbnRzKHRoaXMuZGIsIHRoaXMsIHRoaXMuZm9ybSwgdGhpcy5yZWNvcmRWYWx1ZU9wdGlvbnMpO1xuXG4gICAgYXdhaXQgdGhpcy5kYi5leGVjdXRlKHN0YXRlbWVudHMubWFwKG8gPT4gby5zcWwpLmpvaW4oJ1xcbicpKTtcbiAgfVxuXG4gIGdldEZvcm0oKSB7XG4gICAgcmV0dXJuIHRoaXMubG9hZE9uZSgnZm9ybScsIEZvcm0pO1xuICB9XG5cbiAgZ2V0IGZvcm0oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2Zvcm07XG4gIH1cblxuICBzZXQgZm9ybShmb3JtKSB7XG4gICAgdGhpcy5zZXRPbmUoJ2Zvcm0nLCBmb3JtKTtcbiAgfVxuXG4gIHN0YXRpYyBxdWVyeVJvd1RvQXR0cmlidXRlcyhyb3cpIHtcbiAgICBjb25zdCBhdHRyaWJ1dGVzID0ge1xuICAgICAgaWQ6IHJvdy5fcmVjb3JkX2lkLFxuICAgICAgcHJvamVjdF9pZDogcm93Ll9wcm9qZWN0X2lkLFxuICAgICAgYXNzaWduZWRfdG9faWQ6IHJvdy5fYXNzaWduZWRfdG9faWQsXG4gICAgICBzdGF0dXM6IHJvdy5fc3RhdHVzLFxuICAgICAgbGF0aXR1ZGU6IHJvdy5fbGF0aXR1ZGUsXG4gICAgICBsb25naXR1ZGU6IHJvdy5fbG9uZ2l0dWRlLFxuICAgICAgY2xpZW50X2NyZWF0ZWRfYXQ6IG5ldyBEYXRlKHJvdy5fY3JlYXRlZF9hdCksXG4gICAgICBjbGllbnRfdXBkYXRlZF9hdDogbmV3IERhdGUocm93Ll91cGRhdGVkX2F0KSxcbiAgICAgIHZlcnNpb246IHJvdy5fdmVyc2lvbixcbiAgICAgIGNyZWF0ZWRfYnlfaWQ6IHJvdy5fY3JlYXRlZF9ieV9pZCxcbiAgICAgIHVwZGF0ZWRfYnlfaWQ6IHJvdy5fdXBkYXRlZF9ieV9pZCxcbiAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKHJvdy5fc2VydmVyX2NyZWF0ZWRfYXQpLFxuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUocm93Ll9zZXJ2ZXJfdXBkYXRlZF9hdCksXG4gICAgICBhbHRpdHVkZTogcm93Ll9hbHRpdHVkZSxcbiAgICAgIHNwZWVkOiByb3cuX3NwZWVkLFxuICAgICAgY291cnNlOiByb3cuX2NvdXJzZSxcbiAgICAgIGhvcml6b250YWxfYWNjdXJhY3k6IHJvdy5faG9yaXpvbnRhbF9hY2N1cmFjeSxcbiAgICAgIHZlcnRpY2FsX2FjY3VyYWN5OiByb3cuX3ZlcnRpY2FsX2FjY3VyYWN5LFxuICAgICAgZm9ybV92YWx1ZXM6IEpTT04ucGFyc2Uocm93Ll9mb3JtX3ZhbHVlcyksXG4gICAgICBjaGFuZ2VzZXRfaWQ6IHJvdy5fY2hhbmdlc2V0X2lkLFxuICAgICAgY3JlYXRlZF9sYXRpdHVkZTogcm93Ll9jcmVhdGVkX2xhdGl0dWRlLFxuICAgICAgY3JlYXRlZF9sb25naXR1ZGU6IHJvdy5fY3JlYXRlZF9sb25naXR1ZGUsXG4gICAgICBjcmVhdGVkX2dlb21ldHJ5OiByb3cuX2NyZWF0ZWRfZ2VvbWV0cnksXG4gICAgICBjcmVhdGVkX2FsdGl0dWRlOiByb3cuX2NyZWF0ZWRfYWx0aXR1ZGUsXG4gICAgICBjcmVhdGVkX2hvcml6b250YWxfYWNjdXJhY3k6IHJvdy5fY3JlYXRlZF9ob3Jpem9udGFsX2FjY3VyYWN5LFxuICAgICAgdXBkYXRlZF9sYXRpdHVkZTogcm93Ll91cGRhdGVkX2xhdGl0dWRlLFxuICAgICAgdXBkYXRlZF9sb25naXR1ZGU6IHJvdy5fdXBkYXRlZF9sb25naXR1ZGUsXG4gICAgICB1cGRhdGVkX2dlb21ldHJ5OiByb3cuX3VwZGF0ZWRfZ2VvbWV0cnksXG4gICAgICB1cGRhdGVkX2FsdGl0dWRlOiByb3cuX3VwZGF0ZWRfYWx0aXR1ZGUsXG4gICAgICB1cGRhdGVkX2hvcml6b250YWxfYWNjdXJhY3k6IHJvdy5fdXBkYXRlZF9ob3Jpem9udGFsX2FjY3VyYWN5LFxuICAgICAgY3JlYXRlZF9kdXJhdGlvbjogcm93Ll9jcmVhdGVkX2R1cmF0aW9uLFxuICAgICAgdXBkYXRlZF9kdXJhdGlvbjogcm93Ll91cGRhdGVkX2R1cmF0aW9uLFxuICAgICAgZWRpdGVkX2R1cmF0aW9uOiByb3cuX2VkaXRlZF9kdXJhdGlvblxuICAgIH07XG5cbiAgICByZXR1cm4gYXR0cmlidXRlcztcbiAgfVxufVxuXG5QZXJzaXN0ZW50T2JqZWN0LnJlZ2lzdGVyKFJlY29yZCk7XG4iXX0=