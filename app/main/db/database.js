"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = database;

var _minidb = require("minidb");

var _migrations = _interopRequireDefault(require("./migrations"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

let instance = null;
const defaultDatabaseOptions = {
  wal: true,
  autoVacuum: true,
  synchronous: 'off'
};

async function database(options) {
  if (instance) {
    return instance;
  }

  instance = await _minidb.SQLite.open({ ...defaultDatabaseOptions,
    ...options
  });
  const migrations = new _migrations.default(instance);
  await migrations.migrate();
  return instance;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9tYWluL2RiL2RhdGFiYXNlLmpzIl0sIm5hbWVzIjpbImluc3RhbmNlIiwiZGVmYXVsdERhdGFiYXNlT3B0aW9ucyIsIndhbCIsImF1dG9WYWN1dW0iLCJzeW5jaHJvbm91cyIsImRhdGFiYXNlIiwib3B0aW9ucyIsIlNRTGl0ZSIsIm9wZW4iLCJtaWdyYXRpb25zIiwiTWlncmF0aW9ucyIsIm1pZ3JhdGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7OztBQUVBLElBQUlBLFFBQVEsR0FBRyxJQUFmO0FBRUEsTUFBTUMsc0JBQXNCLEdBQUc7QUFDN0JDLEVBQUFBLEdBQUcsRUFBRSxJQUR3QjtBQUU3QkMsRUFBQUEsVUFBVSxFQUFFLElBRmlCO0FBRzdCQyxFQUFBQSxXQUFXLEVBQUU7QUFIZ0IsQ0FBL0I7O0FBTWUsZUFBZUMsUUFBZixDQUF3QkMsT0FBeEIsRUFBaUM7QUFDOUMsTUFBSU4sUUFBSixFQUFjO0FBQ1osV0FBT0EsUUFBUDtBQUNEOztBQUVEQSxFQUFBQSxRQUFRLEdBQUcsTUFBTU8sZUFBT0MsSUFBUCxDQUFZLEVBQUMsR0FBR1Asc0JBQUo7QUFBNEIsT0FBR0s7QUFBL0IsR0FBWixDQUFqQjtBQUVBLFFBQU1HLFVBQVUsR0FBRyxJQUFJQyxtQkFBSixDQUFlVixRQUFmLENBQW5CO0FBRUEsUUFBTVMsVUFBVSxDQUFDRSxPQUFYLEVBQU47QUFFQSxTQUFPWCxRQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTUUxpdGUgfSBmcm9tICdtaW5pZGInO1xuaW1wb3J0IE1pZ3JhdGlvbnMgZnJvbSAnLi9taWdyYXRpb25zJztcblxubGV0IGluc3RhbmNlID0gbnVsbDtcblxuY29uc3QgZGVmYXVsdERhdGFiYXNlT3B0aW9ucyA9IHtcbiAgd2FsOiB0cnVlLFxuICBhdXRvVmFjdXVtOiB0cnVlLFxuICBzeW5jaHJvbm91czogJ29mZidcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGRhdGFiYXNlKG9wdGlvbnMpIHtcbiAgaWYgKGluc3RhbmNlKSB7XG4gICAgcmV0dXJuIGluc3RhbmNlO1xuICB9XG5cbiAgaW5zdGFuY2UgPSBhd2FpdCBTUUxpdGUub3Blbih7Li4uZGVmYXVsdERhdGFiYXNlT3B0aW9ucywgLi4ub3B0aW9uc30pO1xuXG4gIGNvbnN0IG1pZ3JhdGlvbnMgPSBuZXcgTWlncmF0aW9ucyhpbnN0YW5jZSk7XG5cbiAgYXdhaXQgbWlncmF0aW9ucy5taWdyYXRlKCk7XG5cbiAgcmV0dXJuIGluc3RhbmNlO1xufVxuIl19