"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = database;

var _minidb = require("minidb");

var _migrations = _interopRequireDefault(require("./migrations"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

let instance = null;
const defaultDatabaseOptions = {
  wal: true,
  autoVacuum: true,
  synchronous: 'off'
};

async function database(options) {
  if (instance) {
    return instance;
  }

  instance = await _minidb.SQLite.open({ ...defaultDatabaseOptions,
    ...options
  });
  const migrations = new _migrations.default(instance);
  await migrations.migrate();
  return instance;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kYi9kYXRhYmFzZS5qcyJdLCJuYW1lcyI6WyJpbnN0YW5jZSIsImRlZmF1bHREYXRhYmFzZU9wdGlvbnMiLCJ3YWwiLCJhdXRvVmFjdXVtIiwic3luY2hyb25vdXMiLCJkYXRhYmFzZSIsIm9wdGlvbnMiLCJTUUxpdGUiLCJvcGVuIiwibWlncmF0aW9ucyIsIk1pZ3JhdGlvbnMiLCJtaWdyYXRlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7Ozs7QUFFQSxJQUFJQSxRQUFRLEdBQUcsSUFBZjtBQUVBLE1BQU1DLHNCQUFzQixHQUFHO0FBQzdCQyxFQUFBQSxHQUFHLEVBQUUsSUFEd0I7QUFFN0JDLEVBQUFBLFVBQVUsRUFBRSxJQUZpQjtBQUc3QkMsRUFBQUEsV0FBVyxFQUFFO0FBSGdCLENBQS9COztBQU1lLGVBQWVDLFFBQWYsQ0FBd0JDLE9BQXhCLEVBQWlDO0FBQzlDLE1BQUlOLFFBQUosRUFBYztBQUNaLFdBQU9BLFFBQVA7QUFDRDs7QUFFREEsRUFBQUEsUUFBUSxHQUFHLE1BQU1PLGVBQU9DLElBQVAsQ0FBWSxFQUFDLEdBQUdQLHNCQUFKO0FBQTRCLE9BQUdLO0FBQS9CLEdBQVosQ0FBakI7QUFFQSxRQUFNRyxVQUFVLEdBQUcsSUFBSUMsbUJBQUosQ0FBZVYsUUFBZixDQUFuQjtBQUVBLFFBQU1TLFVBQVUsQ0FBQ0UsT0FBWCxFQUFOO0FBRUEsU0FBT1gsUUFBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU1FMaXRlIH0gZnJvbSAnbWluaWRiJztcbmltcG9ydCBNaWdyYXRpb25zIGZyb20gJy4vbWlncmF0aW9ucyc7XG5cbmxldCBpbnN0YW5jZSA9IG51bGw7XG5cbmNvbnN0IGRlZmF1bHREYXRhYmFzZU9wdGlvbnMgPSB7XG4gIHdhbDogdHJ1ZSxcbiAgYXV0b1ZhY3V1bTogdHJ1ZSxcbiAgc3luY2hyb25vdXM6ICdvZmYnXG59O1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBkYXRhYmFzZShvcHRpb25zKSB7XG4gIGlmIChpbnN0YW5jZSkge1xuICAgIHJldHVybiBpbnN0YW5jZTtcbiAgfVxuXG4gIGluc3RhbmNlID0gYXdhaXQgU1FMaXRlLm9wZW4oey4uLmRlZmF1bHREYXRhYmFzZU9wdGlvbnMsIC4uLm9wdGlvbnN9KTtcblxuICBjb25zdCBtaWdyYXRpb25zID0gbmV3IE1pZ3JhdGlvbnMoaW5zdGFuY2UpO1xuXG4gIGF3YWl0IG1pZ3JhdGlvbnMubWlncmF0ZSgpO1xuXG4gIHJldHVybiBpbnN0YW5jZTtcbn1cbiJdfQ==