"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _minidb = require("minidb");

var _project = _interopRequireDefault(require("./project"));

var _choiceList = _interopRequireDefault(require("./choice-list"));

var _classificationSet = _interopRequireDefault(require("./classification-set"));

var _form = _interopRequireDefault(require("./form"));

var _record = _interopRequireDefault(require("./record"));

var _role = _interopRequireDefault(require("./role"));

var _membership = _interopRequireDefault(require("./membership"));

var _changeset = _interopRequireDefault(require("./changeset"));

var _photo = _interopRequireDefault(require("./photo"));

var _video = _interopRequireDefault(require("./video"));

var _audio = _interopRequireDefault(require("./audio"));

var _signature = _interopRequireDefault(require("./signature"));

var _syncState = _interopRequireDefault(require("./sync-state"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class Account {
  static get tableName() {
    return 'accounts';
  }

  static get columns() {
    return [{
      name: 'userResourceID',
      column: 'user_resource_id',
      type: 'string',
      null: false
    }, {
      name: 'organizationResourceID',
      column: 'organization_resource_id',
      type: 'string',
      null: false
    }, {
      name: 'organizationName',
      column: 'organization_name',
      type: 'string',
      null: false
    }, {
      name: 'email',
      column: 'email',
      type: 'string',
      null: false
    }, {
      name: 'description',
      column: 'description',
      type: 'string'
    }, {
      name: 'firstName',
      column: 'first_name',
      type: 'string'
    }, {
      name: 'lastName',
      column: 'last_name',
      type: 'string'
    }, {
      name: 'lastSyncPhotos',
      column: 'last_sync_photos',
      type: 'datetime'
    }, {
      name: 'lastSyncVideos',
      column: 'last_sync_videos',
      type: 'datetime'
    }, {
      name: 'lastSyncAudio',
      column: 'last_sync_audio',
      type: 'datetime'
    }, {
      name: 'lastSyncSignatures',
      column: 'last_sync_signatures',
      type: 'datetime'
    }, {
      name: 'lastSyncChangesets',
      column: 'last_sync_changesets',
      type: 'datetime'
    }, {
      name: 'token',
      column: 'token',
      type: 'string'
    }, {
      name: 'deletedAt',
      column: 'deleted_at',
      type: 'datetime'
    }];
  }

  get userResourceID() {
    return this._userResourceID;
  }

  get organizationResourceID() {
    return this._organizationResourceID;
  }

  get organizationName() {
    return this._organizationName;
  }

  get email() {
    return this._email;
  }

  get firstName() {
    return this._firstName;
  }

  get lastName() {
    return this._lastName;
  }

  get token() {
    return this._token;
  }

  static findByUserAndOrganization(userID, organizationID, callback) {
    return Account.findFirst({
      user_resource_id: userID,
      organization_resource_id: organizationID
    }, callback);
  }

  findForms(where) {
    return _form.default.findAll(this.db, { ...where,
      account_id: this.rowID
    }, 'name ASC');
  }

  findProjects(where) {
    return _project.default.findAll(this.db, { ...where,
      account_id: this.rowID
    }, 'name ASC');
  }

  findChoiceLists(where) {
    return _choiceList.default.findAll(this.db, { ...where,
      account_id: this.rowID
    }, 'name ASC');
  }

  findClassificationSets(where) {
    return _classificationSet.default.findAll(this.db, { ...where,
      account_id: this.rowID
    }, 'name ASC');
  }

  findRoles(where) {
    return _role.default.findAll(this.db, { ...where,
      account_id: this.rowID
    }, 'name ASC');
  }

  findMemberships(where) {
    return _membership.default.findAll(this.db, { ...where,
      account_id: this.rowID
    }, 'email ASC');
  }

  findFirstForm(where) {
    return _form.default.findFirst(this.db, { ...where,
      account_id: this.rowID
    }, 'name ASC');
  }

  findFirstRecord(where) {
    return _record.default.findFirst(this.db, { ...where,
      account_id: this.rowID
    });
  }

  findEachRecord(where, callback) {
    return _record.default.findEach(this.db, {
      where: { ...where,
        account_id: this.rowID
      }
    }, callback);
  }

  findEachPhoto(where, callback) {
    return _photo.default.findEach(this.db, {
      where: { ...where,
        account_id: this.rowID
      }
    }, callback);
  }

  findEachVideo(where, callback) {
    return _video.default.findEach(this.db, {
      where: { ...where,
        account_id: this.rowID
      }
    }, callback);
  }

  findEachAudio(where, callback) {
    return _audio.default.findEach(this.db, {
      where: { ...where,
        account_id: this.rowID
      }
    }, callback);
  }

  findEachSignature(where, callback) {
    return _signature.default.findEach(this.db, {
      where: { ...where,
        account_id: this.rowID
      }
    }, callback);
  }

  findEachChangeset(where, callback) {
    return _changeset.default.findEach(this.db, {
      where: { ...where,
        account_id: this.rowID
      }
    }, callback);
  }

  findEachRole(where, callback) {
    return _role.default.findEach(this.db, {
      where: { ...where,
        account_id: this.rowID
      }
    }, callback);
  }

  findEachChoiceList(where, callback) {
    return _choiceList.default.findEach(this.db, {
      where: { ...where,
        account_id: this.rowID
      }
    }, callback);
  }

  findEachClassificationSet(where, callback) {
    return _classificationSet.default.findEach(this.db, {
      where: { ...where,
        account_id: this.rowID
      }
    }, callback);
  }

  findEachForm(where, callback) {
    return _form.default.findEach(this.db, {
      where: { ...where,
        account_id: this.rowID
      }
    }, callback);
  }

  findEachProject(where, callback) {
    return _project.default.findEach(this.db, {
      where: { ...where,
        account_id: this.rowID
      }
    }, callback);
  }

  findEachMembership(where, callback) {
    return _membership.default.findEach(this.db, {
      where: { ...where,
        account_id: this.rowID
      }
    }, callback);
  }

  findEachBySQL(sql, values, callback) {
    return this.db.each(sql, values, callback);
  }

  findBySQL(sql, values, callback) {
    return this.db.all(sql, values, callback);
  }

  findActiveForms(where) {
    return _form.default.findAll(this.db, { ...where,
      account_id: this.rowID,
      deleted_at: null
    }, 'name ASC');
  }

  projectByResourceID(projectId) {
    return _project.default.findFirst(this.db, {
      account_id: this.rowID
    });
  }

  findSyncState(where) {
    return _syncState.default.findOrCreate(this.db, { ...where,
      account_id: this.rowID
    });
  }

  async reset() {
    await this.db.execute(`
      DELETE FROM columns WHERE table_name IN (
        SELECT name FROM tables WHERE name LIKE 'account_${this.rowID}_%'
      );
    `);
    await this.db.execute(`
      DELETE FROM tables WHERE name LIKE 'account_${this.rowID}_%';
    `);
    const viewNames = (await this.db.all(`
      SELECT tbl_name AS name FROM sqlite_master
      WHERE type = 'view' AND tbl_name LIKE 'account_${this.rowID}_%'
      ORDER BY tbl_name;
    `)).map(o => o.name);

    for (const viewName of viewNames) {
      await this.db.execute(`DROP VIEW ${this.db.ident(viewName)};`);
    }

    const tableNames = (await this.db.all(`
      SELECT tbl_name AS name FROM sqlite_master
      WHERE type = 'table' AND tbl_name LIKE 'account_${this.rowID}_%'
      ORDER BY tbl_name;
    `)).map(o => o.name);

    for (const tableName of tableNames) {
      await this.db.execute(`DROP TABLE ${this.db.ident(tableName)};`);
    }

    const accountTables = ['audio', 'changesets', 'choice_lists', 'classification_sets', 'forms', 'memberships', 'photos', 'projects', 'records', 'roles', 'signatures', 'videos'];

    for (const tableName of accountTables) {
      await this.db.execute(`DELETE FROM ${this.db.ident(tableName)} WHERE account_id = ${this.rowID};`);
    }

    await this.db.execute(`DELETE FROM sync_state WHERE account_id = ${this.rowID};`);
    this._lastSyncPhotos = null;
    this._lastSyncVideos = null;
    this._lastSyncAudio = null;
    this._lastSyncSignatures = null;
    this._lastSyncChangesets = null;
    await this.save();
    await this.db.execute('VACUUM');
  }

}

exports.default = Account;

_minidb.PersistentObject.register(Account);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2RlbHMvYWNjb3VudC5qcyJdLCJuYW1lcyI6WyJBY2NvdW50IiwidGFibGVOYW1lIiwiY29sdW1ucyIsIm5hbWUiLCJjb2x1bW4iLCJ0eXBlIiwibnVsbCIsInVzZXJSZXNvdXJjZUlEIiwiX3VzZXJSZXNvdXJjZUlEIiwib3JnYW5pemF0aW9uUmVzb3VyY2VJRCIsIl9vcmdhbml6YXRpb25SZXNvdXJjZUlEIiwib3JnYW5pemF0aW9uTmFtZSIsIl9vcmdhbml6YXRpb25OYW1lIiwiZW1haWwiLCJfZW1haWwiLCJmaXJzdE5hbWUiLCJfZmlyc3ROYW1lIiwibGFzdE5hbWUiLCJfbGFzdE5hbWUiLCJ0b2tlbiIsIl90b2tlbiIsImZpbmRCeVVzZXJBbmRPcmdhbml6YXRpb24iLCJ1c2VySUQiLCJvcmdhbml6YXRpb25JRCIsImNhbGxiYWNrIiwiZmluZEZpcnN0IiwidXNlcl9yZXNvdXJjZV9pZCIsIm9yZ2FuaXphdGlvbl9yZXNvdXJjZV9pZCIsImZpbmRGb3JtcyIsIndoZXJlIiwiRm9ybSIsImZpbmRBbGwiLCJkYiIsImFjY291bnRfaWQiLCJyb3dJRCIsImZpbmRQcm9qZWN0cyIsIlByb2plY3QiLCJmaW5kQ2hvaWNlTGlzdHMiLCJDaG9pY2VMaXN0IiwiZmluZENsYXNzaWZpY2F0aW9uU2V0cyIsIkNsYXNzaWZpY2F0aW9uU2V0IiwiZmluZFJvbGVzIiwiUm9sZSIsImZpbmRNZW1iZXJzaGlwcyIsIk1lbWJlcnNoaXAiLCJmaW5kRmlyc3RGb3JtIiwiZmluZEZpcnN0UmVjb3JkIiwiUmVjb3JkIiwiZmluZEVhY2hSZWNvcmQiLCJmaW5kRWFjaCIsImZpbmRFYWNoUGhvdG8iLCJQaG90byIsImZpbmRFYWNoVmlkZW8iLCJWaWRlbyIsImZpbmRFYWNoQXVkaW8iLCJBdWRpbyIsImZpbmRFYWNoU2lnbmF0dXJlIiwiU2lnbmF0dXJlIiwiZmluZEVhY2hDaGFuZ2VzZXQiLCJDaGFuZ2VzZXQiLCJmaW5kRWFjaFJvbGUiLCJmaW5kRWFjaENob2ljZUxpc3QiLCJmaW5kRWFjaENsYXNzaWZpY2F0aW9uU2V0IiwiZmluZEVhY2hGb3JtIiwiZmluZEVhY2hQcm9qZWN0IiwiZmluZEVhY2hNZW1iZXJzaGlwIiwiZmluZEVhY2hCeVNRTCIsInNxbCIsInZhbHVlcyIsImVhY2giLCJmaW5kQnlTUUwiLCJhbGwiLCJmaW5kQWN0aXZlRm9ybXMiLCJkZWxldGVkX2F0IiwicHJvamVjdEJ5UmVzb3VyY2VJRCIsInByb2plY3RJZCIsImZpbmRTeW5jU3RhdGUiLCJTeW5jU3RhdGUiLCJmaW5kT3JDcmVhdGUiLCJyZXNldCIsImV4ZWN1dGUiLCJ2aWV3TmFtZXMiLCJtYXAiLCJvIiwidmlld05hbWUiLCJpZGVudCIsInRhYmxlTmFtZXMiLCJhY2NvdW50VGFibGVzIiwiX2xhc3RTeW5jUGhvdG9zIiwiX2xhc3RTeW5jVmlkZW9zIiwiX2xhc3RTeW5jQXVkaW8iLCJfbGFzdFN5bmNTaWduYXR1cmVzIiwiX2xhc3RTeW5jQ2hhbmdlc2V0cyIsInNhdmUiLCJQZXJzaXN0ZW50T2JqZWN0IiwicmVnaXN0ZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVlLE1BQU1BLE9BQU4sQ0FBYztBQUNQLGFBQVRDLFNBQVMsR0FBRztBQUNyQixXQUFPLFVBQVA7QUFDRDs7QUFFaUIsYUFBUEMsT0FBTyxHQUFHO0FBQ25CLFdBQU8sQ0FDTDtBQUFFQyxNQUFBQSxJQUFJLEVBQUUsZ0JBQVI7QUFBMEJDLE1BQUFBLE1BQU0sRUFBRSxrQkFBbEM7QUFBc0RDLE1BQUFBLElBQUksRUFBRSxRQUE1RDtBQUFzRUMsTUFBQUEsSUFBSSxFQUFFO0FBQTVFLEtBREssRUFFTDtBQUFFSCxNQUFBQSxJQUFJLEVBQUUsd0JBQVI7QUFBa0NDLE1BQUFBLE1BQU0sRUFBRSwwQkFBMUM7QUFBc0VDLE1BQUFBLElBQUksRUFBRSxRQUE1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Um9CLEVBU3BCLFNBVG9CLEVBVXBCLE9BVm9CLEVBV3BCLFlBWG9CLEVBWXBCLFFBWm9CLENBQXRCOztBQWVBLFNBQUssTUFBTXRGLFNBQVgsSUFBd0JzRixhQUF4QixFQUF1QztBQUNyQyxZQUFNLEtBQUt2RCxFQUFMLENBQVFnRCxPQUFSLENBQWlCLGVBQWMsS0FBS2hELEVBQUwsQ0FBUXFELEtBQVIsQ0FBY3BGLFNBQWQsQ0FBeUIsdUJBQXNCLEtBQUtpQyxLQUFNLEdBQXpGLENBQU47QUFDRDs7QUFFRCxVQUFNLEtBQUtGLEVBQUwsQ0FBUWdELE9BQVIsQ0FBaUIsNkNBQTRDLEtBQUs5QyxLQUFNLEdBQXhFLENBQU47QUFFQSxTQUFLc0QsZUFBTCxHQUF1QixJQUF2QjtBQUNBLFNBQUtDLGVBQUwsR0FBdUIsSUFBdkI7QUFDQSxTQUFLQyxjQUFMLEdBQXNCLElBQXRCO0FBQ0EsU0FBS0MsbUJBQUwsR0FBMkIsSUFBM0I7QUFDQSxTQUFLQyxtQkFBTCxHQUEyQixJQUEzQjtBQUVBLFVBQU0sS0FBS0MsSUFBTCxFQUFOO0FBRUEsVUFBTSxLQUFLN0QsRUFBTCxDQUFRZ0QsT0FBUixDQUFnQixRQUFoQixDQUFOO0FBQ0Q7O0FBMU4wQjs7OztBQTZON0JjLHlCQUFpQkMsUUFBakIsQ0FBMEIvRixPQUExQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBlcnNpc3RlbnRPYmplY3QgfSBmcm9tICdtaW5pZGInO1xuaW1wb3J0IFByb2plY3QgZnJvbSAnLi9wcm9qZWN0JztcbmltcG9ydCBDaG9pY2VMaXN0IGZyb20gJy4vY2hvaWNlLWxpc3QnO1xuaW1wb3J0IENsYXNzaWZpY2F0aW9uU2V0IGZyb20gJy4vY2xhc3NpZmljYXRpb24tc2V0JztcbmltcG9ydCBGb3JtIGZyb20gJy4vZm9ybSc7XG5pbXBvcnQgUmVjb3JkIGZyb20gJy4vcmVjb3JkJztcbmltcG9ydCBSb2xlIGZyb20gJy4vcm9sZSc7XG5pbXBvcnQgTWVtYmVyc2hpcCBmcm9tICcuL21lbWJlcnNoaXAnO1xuaW1wb3J0IENoYW5nZXNldCBmcm9tICcuL2NoYW5nZXNldCc7XG5pbXBvcnQgUGhvdG8gZnJvbSAnLi9waG90byc7XG5pbXBvcnQgVmlkZW8gZnJvbSAnLi92aWRlbyc7XG5pbXBvcnQgQXVkaW8gZnJvbSAnLi9hdWRpbyc7XG5pbXBvcnQgU2lnbmF0dXJlIGZyb20gJy4vc2lnbmF0dXJlJztcbmltcG9ydCBTeW5jU3RhdGUgZnJvbSAnLi9zeW5jLXN0YXRlJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQWNjb3VudCB7XG4gIHN0YXRpYyBnZXQgdGFibGVOYW1lKCkge1xuICAgIHJldHVybiAnYWNjb3VudHMnO1xuICB9XG5cbiAgc3RhdGljIGdldCBjb2x1bW5zKCkge1xuICAgIHJldHVybiBbXG4gICAgICB7IG5hbWU6ICd1c2VyUmVzb3VyY2VJRCcsIGNvbHVtbjogJ3VzZXJfcmVzb3VyY2VfaWQnLCB0eXBlOiAnc3RyaW5nJywgbnVsbDogZmFsc2UgfSxcbiAgICAgIHsgbmFtZTogJ29yZ2FuaXphdGlvblJlc291cmNlSUQnLCBjb2x1bW46ICdvcmdhbml6YXRpb25fcmVzb3VyY2VfaWQnLCB0eXBlOiAnc3RyaW5nJywgbnVsbDogZmFsc2UgfSxcbiAgICAgIHsgbmFtZTogJ29yZ2FuaXphdGlvbk5hbWUnLCBjb2x1bW46ICdvcmdhbml6YXRpb25fbmFtZScsIHR5cGU6ICdzdHJpbmcnLCBudWxsOiBmYWxzZSB9LFxuICAgICAgeyBuYW1lOiAnZW1haWwnLCBjb2x1bW46ICdlbWFpbCcsIHR5cGU6ICdzdHJpbmcnLCBudWxsOiBmYWxzZSB9LFxuICAgICAgeyBuYW1lOiAnZGVzY3JpcHRpb24nLCBjb2x1bW46ICdkZXNjcmlwdGlvbicsIHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICB7IG5hbWU6ICdmaXJzdE5hbWUnLCBjb2x1bW46ICdmaXJzdF9uYW1lJywgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgIHsgbmFtZTogJ2xhc3ROYW1lJywgY29sdW1uOiAnbGFzdF9uYW1lJywgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgIHsgbmFtZTogJ2xhc3RTeW5jUGhvdG9zJywgY29sdW1uOiAnbGFzdF9zeW5jX3Bob3RvcycsIHR5cGU6ICdkYXRldGltZScgfSxcbiAgICAgIHsgbmFtZTogJ2xhc3RTeW5jVmlkZW9zJywgY29sdW1uOiAnbGFzdF9zeW5jX3ZpZGVvcycsIHR5cGU6ICdkYXRldGltZScgfSxcbiAgICAgIHsgbmFtZTogJ2xhc3RTeW5jQXVkaW8nLCBjb2x1bW46ICdsYXN0X3N5bmNfYXVkaW8nLCB0eXBlOiAnZGF0ZXRpbWUnIH0sXG4gICAgICB7IG5hbWU6ICdsYXN0U3luY1NpZ25hdHVyZXMnLCBjb2x1bW46ICdsYXN0X3N5bmNfc2lnbmF0dXJlcycsIHR5cGU6ICdkYXRldGltZScgfSxcbiAgICAgIHsgbmFtZTogJ2xhc3RTeW5jQ2hhbmdlc2V0cycsIGNvbHVtbjogJ2xhc3Rfc3luY19jaGFuZ2VzZXRzJywgdHlwZTogJ2RhdGV0aW1lJyB9LFxuICAgICAgeyBuYW1lOiAndG9rZW4nLCBjb2x1bW46ICd0b2tlbicsIHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICB7IG5hbWU6ICdkZWxldGVkQXQnLCBjb2x1bW46ICdkZWxldGVkX2F0JywgdHlwZTogJ2RhdGV0aW1lJyB9XG4gICAgXTtcbiAgfVxuXG4gIGdldCB1c2VyUmVzb3VyY2VJRCgpIHtcbiAgICByZXR1cm4gdGhpcy5fdXNlclJlc291cmNlSUQ7XG4gIH1cblxuICBnZXQgb3JnYW5pemF0aW9uUmVzb3VyY2VJRCgpIHtcbiAgICByZXR1cm4gdGhpcy5fb3JnYW5pemF0aW9uUmVzb3VyY2VJRDtcbiAgfVxuXG4gIGdldCBvcmdhbml6YXRpb25OYW1lKCkge1xuICAgIHJldHVybiB0aGlzLl9vcmdhbml6YXRpb25OYW1lO1xuICB9XG5cbiAgZ2V0IGVtYWlsKCkge1xuICAgIHJldHVybiB0aGlzLl9lbWFpbDtcbiAgfVxuXG4gIGdldCBmaXJzdE5hbWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZpcnN0TmFtZTtcbiAgfVxuXG4gIGdldCBsYXN0TmFtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fbGFzdE5hbWU7XG4gIH1cblxuICBnZXQgdG9rZW4oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3Rva2VuO1xuICB9XG5cbiAgc3RhdGljIGZpbmRCeVVzZXJBbmRPcmdhbml6YXRpb24odXNlcklELCBvcmdhbml6YXRpb25JRCwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gQWNjb3VudC5maW5kRmlyc3Qoe3VzZXJfcmVzb3VyY2VfaWQ6IHVzZXJJRCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZ2FuaXphdGlvbl9yZXNvdXJjZV9pZDogb3JnYW5pemF0aW9uSUR9LCBjYWxsYmFjayk7XG4gIH1cblxuICBmaW5kRm9ybXMod2hlcmUpIHtcbiAgICByZXR1cm4gRm9ybS5maW5kQWxsKHRoaXMuZGIsIHsuLi53aGVyZSwgYWNjb3VudF9pZDogdGhpcy5yb3dJRH0sICduYW1lIEFTQycpO1xuICB9XG5cbiAgZmluZFByb2plY3RzKHdoZXJlKSB7XG4gICAgcmV0dXJuIFByb2plY3QuZmluZEFsbCh0aGlzLmRiLCB7Li4ud2hlcmUsIGFjY291bnRfaWQ6IHRoaXMucm93SUR9LCAnbmFtZSBBU0MnKTtcbiAgfVxuXG4gIGZpbmRDaG9pY2VMaXN0cyh3aGVyZSkge1xuICAgIHJldHVybiBDaG9pY2VMaXN0LmZpbmRBbGwodGhpcy5kYiwgey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfSwgJ25hbWUgQVNDJyk7XG4gIH1cblxuICBmaW5kQ2xhc3NpZmljYXRpb25TZXRzKHdoZXJlKSB7XG4gICAgcmV0dXJuIENsYXNzaWZpY2F0aW9uU2V0LmZpbmRBbGwodGhpcy5kYiwgey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfSwgJ25hbWUgQVNDJyk7XG4gIH1cblxuICBmaW5kUm9sZXMod2hlcmUpIHtcbiAgICByZXR1cm4gUm9sZS5maW5kQWxsKHRoaXMuZGIsIHsuLi53aGVyZSwgYWNjb3VudF9pZDogdGhpcy5yb3dJRH0sICduYW1lIEFTQycpO1xuICB9XG5cbiAgZmluZE1lbWJlcnNoaXBzKHdoZXJlKSB7XG4gICAgcmV0dXJuIE1lbWJlcnNoaXAuZmluZEFsbCh0aGlzLmRiLCB7Li4ud2hlcmUsIGFjY291bnRfaWQ6IHRoaXMucm93SUR9LCAnZW1haWwgQVNDJyk7XG4gIH1cblxuICBmaW5kRmlyc3RGb3JtKHdoZXJlKSB7XG4gICAgcmV0dXJuIEZvcm0uZmluZEZpcnN0KHRoaXMuZGIsIHsuLi53aGVyZSwgYWNjb3VudF9pZDogdGhpcy5yb3dJRH0sICduYW1lIEFTQycpO1xuICB9XG5cbiAgZmluZEZpcnN0UmVjb3JkKHdoZXJlKSB7XG4gICAgcmV0dXJuIFJlY29yZC5maW5kRmlyc3QodGhpcy5kYiwgey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfSk7XG4gIH1cblxuICBmaW5kRWFjaFJlY29yZCh3aGVyZSwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gUmVjb3JkLmZpbmRFYWNoKHRoaXMuZGIsIHt3aGVyZTogey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfX0sIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGZpbmRFYWNoUGhvdG8od2hlcmUsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIFBob3RvLmZpbmRFYWNoKHRoaXMuZGIsIHt3aGVyZTogey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfX0sIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGZpbmRFYWNoVmlkZW8od2hlcmUsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIFZpZGVvLmZpbmRFYWNoKHRoaXMuZGIsIHt3aGVyZTogey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfX0sIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGZpbmRFYWNoQXVkaW8od2hlcmUsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIEF1ZGlvLmZpbmRFYWNoKHRoaXMuZGIsIHt3aGVyZTogey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfX0sIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGZpbmRFYWNoU2lnbmF0dXJlKHdoZXJlLCBjYWxsYmFjaykge1xuICAgIHJldHVybiBTaWduYXR1cmUuZmluZEVhY2godGhpcy5kYiwge3doZXJlOiB7Li4ud2hlcmUsIGFjY291bnRfaWQ6IHRoaXMucm93SUR9fSwgY2FsbGJhY2spO1xuICB9XG5cbiAgZmluZEVhY2hDaGFuZ2VzZXQod2hlcmUsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIENoYW5nZXNldC5maW5kRWFjaCh0aGlzLmRiLCB7d2hlcmU6IHsuLi53aGVyZSwgYWNjb3VudF9pZDogdGhpcy5yb3dJRH19LCBjYWxsYmFjayk7XG4gIH1cblxuICBmaW5kRWFjaFJvbGUod2hlcmUsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIFJvbGUuZmluZEVhY2godGhpcy5kYiwge3doZXJlOiB7Li4ud2hlcmUsIGFjY291bnRfaWQ6IHRoaXMucm93SUR9fSwgY2FsbGJhY2spO1xuICB9XG5cbiAgZmluZEVhY2hDaG9pY2VMaXN0KHdoZXJlLCBjYWxsYmFjaykge1xuICAgIHJldHVybiBDaG9pY2VMaXN0LmZpbmRFYWNoKHRoaXMuZGIsIHt3aGVyZTogey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfX0sIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGZpbmRFYWNoQ2xhc3NpZmljYXRpb25TZXQod2hlcmUsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIENsYXNzaWZpY2F0aW9uU2V0LmZpbmRFYWNoKHRoaXMuZGIsIHt3aGVyZTogey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfX0sIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGZpbmRFYWNoRm9ybSh3aGVyZSwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gRm9ybS5maW5kRWFjaCh0aGlzLmRiLCB7d2hlcmU6IHsuLi53aGVyZSwgYWNjb3VudF9pZDogdGhpcy5yb3dJRH19LCBjYWxsYmFjayk7XG4gIH1cblxuICBmaW5kRWFjaFByb2plY3Qod2hlcmUsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIFByb2plY3QuZmluZEVhY2godGhpcy5kYiwge3doZXJlOiB7Li4ud2hlcmUsIGFjY291bnRfaWQ6IHRoaXMucm93SUR9fSwgY2FsbGJhY2spO1xuICB9XG5cbiAgZmluZEVhY2hNZW1iZXJzaGlwKHdoZXJlLCBjYWxsYmFjaykge1xuICAgIHJldHVybiBNZW1iZXJzaGlwLmZpbmRFYWNoKHRoaXMuZGIsIHt3aGVyZTogey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfX0sIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGZpbmRFYWNoQnlTUUwoc3FsLCB2YWx1ZXMsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIHRoaXMuZGIuZWFjaChzcWwsIHZhbHVlcywgY2FsbGJhY2spO1xuICB9XG5cbiAgZmluZEJ5U1FMKHNxbCwgdmFsdWVzLCBjYWxsYmFjaykge1xuICAgIHJldHVybiB0aGlzLmRiLmFsbChzcWwsIHZhbHVlcywgY2FsbGJhY2spO1xuICB9XG5cbiAgZmluZEFjdGl2ZUZvcm1zKHdoZXJlKSB7XG4gICAgcmV0dXJuIEZvcm0uZmluZEFsbCh0aGlzLmRiLCB7Li4ud2hlcmUsIGFjY291bnRfaWQ6IHRoaXMucm93SUQsIGRlbGV0ZWRfYXQ6IG51bGx9LCAnbmFtZSBBU0MnKTtcbiAgfVxuXG4gIHByb2plY3RCeVJlc291cmNlSUQocHJvamVjdElkKSB7XG4gICAgcmV0dXJuIFByb2plY3QuZmluZEZpcnN0KHRoaXMuZGIsIHthY2NvdW50X2lkOiB0aGlzLnJvd0lEfSk7XG4gIH1cblxuICBmaW5kU3luY1N0YXRlKHdoZXJlKSB7XG4gICAgcmV0dXJuIFN5bmNTdGF0ZS5maW5kT3JDcmVhdGUodGhpcy5kYiwgey4uLndoZXJlLCBhY2NvdW50X2lkOiB0aGlzLnJvd0lEfSk7XG4gIH1cblxuICBhc3luYyByZXNldCgpIHtcbiAgICBhd2FpdCB0aGlzLmRiLmV4ZWN1dGUoYFxuICAgICAgREVMRVRFIEZST00gY29sdW1ucyBXSEVSRSB0YWJsZV9uYW1lIElOIChcbiAgICAgICAgU0VMRUNUIG5hbWUgRlJPTSB0YWJsZXMgV0hFUkUgbmFtZSBMSUtFICdhY2NvdW50XyR7dGhpcy5yb3dJRH1fJSdcbiAgICAgICk7XG4gICAgYCk7XG5cbiAgICBhd2FpdCB0aGlzLmRiLmV4ZWN1dGUoYFxuICAgICAgREVMRVRFIEZST00gdGFibGVzIFdIRVJFIG5hbWUgTElLRSAnYWNjb3VudF8ke3RoaXMucm93SUR9XyUnO1xuICAgIGApO1xuXG4gICAgY29uc3Qgdmlld05hbWVzID0gKGF3YWl0IHRoaXMuZGIuYWxsKGBcbiAgICAgIFNFTEVDVCB0YmxfbmFtZSBBUyBuYW1lIEZST00gc3FsaXRlX21hc3RlclxuICAgICAgV0hFUkUgdHlwZSA9ICd2aWV3JyBBTkQgdGJsX25hbWUgTElLRSAnYWNjb3VudF8ke3RoaXMucm93SUR9XyUnXG4gICAgICBPUkRFUiBCWSB0YmxfbmFtZTtcbiAgICBgKSkubWFwKG8gPT4gby5uYW1lKTtcblxuICAgIGZvciAoY29uc3Qgdmlld05hbWUgb2Ygdmlld05hbWVzKSB7XG4gICAgICBhd2FpdCB0aGlzLmRiLmV4ZWN1dGUoYERST1AgVklFVyAke3RoaXMuZGIuaWRlbnQodmlld05hbWUpfTtgKTtcbiAgICB9XG5cbiAgICBjb25zdCB0YWJsZU5hbWVzID0gKGF3YWl0IHRoaXMuZGIuYWxsKGBcbiAgICAgIFNFTEVDVCB0YmxfbmFtZSBBUyBuYW1lIEZST00gc3FsaXRlX21hc3RlclxuICAgICAgV0hFUkUgdHlwZSA9ICd0YWJsZScgQU5EIHRibF9uYW1lIExJS0UgJ2FjY291bnRfJHt0aGlzLnJvd0lEfV8lJ1xuICAgICAgT1JERVIgQlkgdGJsX25hbWU7XG4gICAgYCkpLm1hcChvID0+IG8ubmFtZSk7XG5cbiAgICBmb3IgKGNvbnN0IHRhYmxlTmFtZSBvZiB0YWJsZU5hbWVzKSB7XG4gICAgICBhd2FpdCB0aGlzLmRiLmV4ZWN1dGUoYERST1AgVEFCTEUgJHt0aGlzLmRiLmlkZW50KHRhYmxlTmFtZSl9O2ApO1xuICAgIH1cblxuICAgIGNvbnN0IGFjY291bnRUYWJsZXMgPSBbXG4gICAgICAnYXVkaW8nLFxuICAgICAgJ2NoYW5nZXNldHMnLFxuICAgICAgJ2Nob2ljZV9saXN0cycsXG4gICAgICAnY2xhc3NpZmljYXRpb25fc2V0cycsXG4gICAgICAnZm9ybXMnLFxuICAgICAgJ21lbWJlcnNoaXBzJyxcbiAgICAgICdwaG90b3MnLFxuICAgICAgJ3Byb2plY3RzJyxcbiAgICAgICdyZWNvcmRzJyxcbiAgICAgICdyb2xlcycsXG4gICAgICAnc2lnbmF0dXJlcycsXG4gICAgICAndmlkZW9zJ1xuICAgIF07XG5cbiAgICBmb3IgKGNvbnN0IHRhYmxlTmFtZSBvZiBhY2NvdW50VGFibGVzKSB7XG4gICAgICBhd2FpdCB0aGlzLmRiLmV4ZWN1dGUoYERFTEVURSBGUk9NICR7dGhpcy5kYi5pZGVudCh0YWJsZU5hbWUpfSBXSEVSRSBhY2NvdW50X2lkID0gJHt0aGlzLnJvd0lEfTtgKTtcbiAgICB9XG5cbiAgICBhd2FpdCB0aGlzLmRiLmV4ZWN1dGUoYERFTEVURSBGUk9NIHN5bmNfc3RhdGUgV0hFUkUgYWNjb3VudF9pZCA9ICR7dGhpcy5yb3dJRH07YCk7XG5cbiAgICB0aGlzLl9sYXN0U3luY1Bob3RvcyA9IG51bGw7XG4gICAgdGhpcy5fbGFzdFN5bmNWaWRlb3MgPSBudWxsO1xuICAgIHRoaXMuX2xhc3RTeW5jQXVkaW8gPSBudWxsO1xuICAgIHRoaXMuX2xhc3RTeW5jU2lnbmF0dXJlcyA9IG51bGw7XG4gICAgdGhpcy5fbGFzdFN5bmNDaGFuZ2VzZXRzID0gbnVsbDtcblxuICAgIGF3YWl0IHRoaXMuc2F2ZSgpO1xuXG4gICAgYXdhaXQgdGhpcy5kYi5leGVjdXRlKCdWQUNVVU0nKTtcbiAgfVxufVxuXG5QZXJzaXN0ZW50T2JqZWN0LnJlZ2lzdGVyKEFjY291bnQpO1xuIl19