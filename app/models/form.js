"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _minidb = require("minidb");

var _fulcrumCore = require("fulcrum-core");

var _record = _interopRequireDefault(require("./record"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class Form extends _fulcrumCore.Form {
  static get tableName() {
    return 'forms';
  }

  static get columns() {
    return [{
      name: 'accountRowID',
      column: 'account_id',
      type: 'integer',
      null: false
    }, {
      name: 'id',
      column: 'resource_id',
      type: 'string',
      null: false
    }, {
      name: 'name',
      column: 'name',
      type: 'string',
      null: false
    }, {
      name: 'version',
      column: 'version',
      type: 'integer',
      null: false
    }, {
      name: 'description',
      column: 'description',
      type: 'string'
    }, {
      name: 'elementsJSON',
      column: 'elements',
      type: 'json',
      null: false
    }, {
      name: 'titleFieldKeysJSON',
      column: 'title_field_keys',
      type: 'json'
    }, {
      name: 'statusFieldJSON',
      column: 'status_field',
      type: 'json'
    }, {
      name: 'geometryTypes',
      column: 'geometry_types',
      type: 'json'
    }, {
      name: 'geometryRequired',
      column: 'geometry_required',
      type: 'boolean'
    }, {
      name: 'projectEnabled',
      column: 'projects_enabled',
      type: 'boolean'
    }, {
      name: 'assignmentEnabled',
      column: 'assignment_enabled',
      type: 'boolean'
    }, {
      name: 'autoAssign',
      column: 'auto_assign',
      type: 'boolean'
    }, {
      name: 'hiddenOnDashboard',
      column: 'hidden_on_dashboard',
      type: 'boolean'
    }, {
      name: 'image',
      column: 'image',
      type: 'string'
    }, {
      name: 'imageLarge',
      column: 'image_large',
      type: 'string'
    }, {
      name: 'imageSmall',
      column: 'image_small',
      type: 'string'
    }, {
      name: 'imageThumbnail',
      column: 'image_thumbnail',
      type: 'string'
    }, {
      name: 'lastSync',
      column: 'last_sync',
      type: 'datetime'
    }, {
      name: 'script',
      column: 'script',
      type: 'string'
    }, {
      name: 'createdAt',
      column: 'server_created_at',
      type: 'datetime'
    }, {
      name: 'updatedAt',
      column: 'server_updated_at',
      type: 'datetime'
    }, {
      name: 'deletedAt',
      column: 'deleted_at',
      type: 'datetime'
    }];
  }

  findEachRecord(where, callback) {
    return _record.default.findEach(this.db, {
      where: { ...where,
        form_id: this.rowID
      }
    }, callback);
  }

  async findRecordsBySQL(sql, values) {
    const tableName = `account_${this._accountRowID}_form_${this.rowID}_view_full`;
    sql = 'SELECT * FROM ' + tableName + (sql ? ' WHERE ' + sql : '');
    const rows = await this.db.all(sql, values);
    const records = [];

    for (const row of rows) {
      const attributes = _record.default.queryRowToAttributes(row);

      const record = new _record.default(attributes, this);
      record._db = this.db;
      records.push(record);
    }

    return records;
  }

}

exports.default = Form;

_minidb.PersistentObject.register(Form);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2RlbHMvZm9ybS5qcyJdLCJuYW1lcyI6WyJGb3JtIiwiRm9ybUJhc2UiLCJ0YWJsZU5hbWUiLCJjb2x1bW5zIiwibmFtZSIsImNvbHVtbiIsInR5cGUiLCJudWxsIiwiZmluZEVhY2hSZWNvcmQiLCJ3aGVyZSIsImNhbGxiYWNrIiwiUmVjb3JkIiwiZmluZEVhY2giLCJkYiIsImZvcm1faWQiLCJyb3dJRCIsImZpbmRSZWNvcmRzQnlTUUwiLCJzcWwiLCJ2YWx1ZXMiLCJfYWNjb3VudFJvd0lEIiwicm93cyIsImFsbCIsInJlY29yZHMiLCJyb3ciLCJhdHRyaWJ1dGVzIiwicXVlcnlSb3dUb0F0dHJpYnV0ZXMiLCJyZWNvcmQiLCJfZGIiLCJwdXNoIiwiUGVyc2lzdGVudE9iamVjdCIsInJlZ2lzdGVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7QUFFZSxNQUFNQSxJQUFOLFNBQW1CQyxpQkFBbkIsQ0FBNEI7QUFDckIsYUFBVEMsU0FBUyxHQUFHO0FBQ3JCLFdBQU8sT0FBUDtBQUNEOztBQUVpQixhQUFQQyxPQUFPLEdBQUc7QUFDbkIsV0FBTyxDQUNMO0FBQUVDLE1BQUFBLElBQUksRUFBRSxjQUFSO0FBQXdCQyxNQUFBQSxNQUFNLEVBQUUsWUFBaEM7QUFBOENDLE1BQUFBLElBQUksRUFBRSxTQUFwRDtBQUErREMsTUFBQUEsSUFBSSxFQUFFO0FBQXJFLEtBREssRUFFTDtBQUFFSCxNQUFBQSxJQUFJLEVBQUUsSUFBUjtBQUFjQyxNQUFBQSxNQUFNLEVBQUUsYUFBdEI7QUFBcUNDLE1BQUFBLElBQUksRUFBRSxRQUEzQztBQUFxREMsTUFBQUEsSUFBSSxFQUFFO0FBQTNELEtBRkssRUFHTDtBQUFFSCxNQUFBQSxJQUFJLEVBQUUsTUFBUjtBQUFnQkMsTUFBQUEsTUFBTSxFQUFFLE1BQXhCO0FBQWdDQyxNQUFBQSxJQUFJLEVBQUUsUUFBdEM7QUFBZ0RDLE1BQUFBLElBQUksRUFBRTtBQUF0RCxLQUhL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QUFFQVMsTUFBQUEsT0FBTyxDQUFDTSxJQUFSLENBQWFGLE1BQWI7QUFDRDs7QUFFRCxXQUFPSixPQUFQO0FBQ0Q7O0FBekR3Qzs7OztBQTREM0NPLHlCQUFpQkMsUUFBakIsQ0FBMEI5QixJQUExQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBlcnNpc3RlbnRPYmplY3QgfSBmcm9tICdtaW5pZGInO1xuaW1wb3J0IHsgRm9ybSBhcyBGb3JtQmFzZSB9IGZyb20gJ2Z1bGNydW0tY29yZSc7XG5pbXBvcnQgUmVjb3JkIGZyb20gJy4vcmVjb3JkJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRm9ybSBleHRlbmRzIEZvcm1CYXNlIHtcbiAgc3RhdGljIGdldCB0YWJsZU5hbWUoKSB7XG4gICAgcmV0dXJuICdmb3Jtcyc7XG4gIH1cblxuICBzdGF0aWMgZ2V0IGNvbHVtbnMoKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHsgbmFtZTogJ2FjY291bnRSb3dJRCcsIGNvbHVtbjogJ2FjY291bnRfaWQnLCB0eXBlOiAnaW50ZWdlcicsIG51bGw6IGZhbHNlIH0sXG4gICAgICB7IG5hbWU6ICdpZCcsIGNvbHVtbjogJ3Jlc291cmNlX2lkJywgdHlwZTogJ3N0cmluZycsIG51bGw6IGZhbHNlIH0sXG4gICAgICB7IG5hbWU6ICduYW1lJywgY29sdW1uOiAnbmFtZScsIHR5cGU6ICdzdHJpbmcnLCBudWxsOiBmYWxzZSB9LFxuICAgICAgeyBuYW1lOiAndmVyc2lvbicsIGNvbHVtbjogJ3ZlcnNpb24nLCB0eXBlOiAnaW50ZWdlcicsIG51bGw6IGZhbHNlIH0sXG4gICAgICB7IG5hbWU6ICdkZXNjcmlwdGlvbicsIGNvbHVtbjogJ2Rlc2NyaXB0aW9uJywgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgIHsgbmFtZTogJ2VsZW1lbnRzSlNPTicsIGNvbHVtbjogJ2VsZW1lbnRzJywgdHlwZTogJ2pzb24nLCBudWxsOiBmYWxzZSB9LFxuICAgICAgeyBuYW1lOiAndGl0bGVGaWVsZEtleXNKU09OJywgY29sdW1uOiAndGl0bGVfZmllbGRfa2V5cycsIHR5cGU6ICdqc29uJyB9LFxuICAgICAgeyBuYW1lOiAnc3RhdHVzRmllbGRKU09OJywgY29sdW1uOiAnc3RhdHVzX2ZpZWxkJywgdHlwZTogJ2pzb24nIH0sXG4gICAgICB7IG5hbWU6ICdnZW9tZXRyeVR5cGVzJywgY29sdW1uOiAnZ2VvbWV0cnlfdHlwZXMnLCB0eXBlOiAnanNvbicgfSxcbiAgICAgIHsgbmFtZTogJ2dlb21ldHJ5UmVxdWlyZWQnLCBjb2x1bW46ICdnZW9tZXRyeV9yZXF1aXJlZCcsIHR5cGU6ICdib29sZWFuJyB9LFxuICAgICAgeyBuYW1lOiAncHJvamVjdEVuYWJsZWQnLCBjb2x1bW46ICdwcm9qZWN0c19lbmFibGVkJywgdHlwZTogJ2Jvb2xlYW4nIH0sXG4gICAgICB7IG5hbWU6ICdhc3NpZ25tZW50RW5hYmxlZCcsIGNvbHVtbjogJ2Fzc2lnbm1lbnRfZW5hYmxlZCcsIHR5cGU6ICdib29sZWFuJyB9LFxuICAgICAgeyBuYW1lOiAnYXV0b0Fzc2lnbicsIGNvbHVtbjogJ2F1dG9fYXNzaWduJywgdHlwZTogJ2Jvb2xlYW4nIH0sXG4gICAgICB7IG5hbWU6ICdoaWRkZW5PbkRhc2hib2FyZCcsIGNvbHVtbjogJ2hpZGRlbl9vbl9kYXNoYm9hcmQnLCB0eXBlOiAnYm9vbGVhbicgfSxcbiAgICAgIHsgbmFtZTogJ2ltYWdlJywgY29sdW1uOiAnaW1hZ2UnLCB0eXBlOiAnc3RyaW5nJyB9LFxuICAgICAgeyBuYW1lOiAnaW1hZ2VMYXJnZScsIGNvbHVtbjogJ2ltYWdlX2xhcmdlJywgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgIHsgbmFtZTogJ2ltYWdlU21hbGwnLCBjb2x1bW46ICdpbWFnZV9zbWFsbCcsIHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICB7IG5hbWU6ICdpbWFnZVRodW1ibmFpbCcsIGNvbHVtbjogJ2ltYWdlX3RodW1ibmFpbCcsIHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICB7IG5hbWU6ICdsYXN0U3luYycsIGNvbHVtbjogJ2xhc3Rfc3luYycsIHR5cGU6ICdkYXRldGltZScgfSxcbiAgICAgIHsgbmFtZTogJ3NjcmlwdCcsIGNvbHVtbjogJ3NjcmlwdCcsIHR5cGU6ICdzdHJpbmcnIH0sXG4gICAgICB7IG5hbWU6ICdjcmVhdGVkQXQnLCBjb2x1bW46ICdzZXJ2ZXJfY3JlYXRlZF9hdCcsIHR5cGU6ICdkYXRldGltZScgfSxcbiAgICAgIHsgbmFtZTogJ3VwZGF0ZWRBdCcsIGNvbHVtbjogJ3NlcnZlcl91cGRhdGVkX2F0JywgdHlwZTogJ2RhdGV0aW1lJyB9LFxuICAgICAgeyBuYW1lOiAnZGVsZXRlZEF0JywgY29sdW1uOiAnZGVsZXRlZF9hdCcsIHR5cGU6ICdkYXRldGltZScgfVxuICAgIF07XG4gIH1cblxuICBmaW5kRWFjaFJlY29yZCh3aGVyZSwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gUmVjb3JkLmZpbmRFYWNoKHRoaXMuZGIsIHt3aGVyZTogey4uLndoZXJlLCBmb3JtX2lkOiB0aGlzLnJvd0lEfX0sIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGFzeW5jIGZpbmRSZWNvcmRzQnlTUUwoc3FsLCB2YWx1ZXMpIHtcbiAgICBjb25zdCB0YWJsZU5hbWUgPSBgYWNjb3VudF8ke3RoaXMuX2FjY291bnRSb3dJRH1fZm9ybV8ke3RoaXMucm93SUR9X3ZpZXdfZnVsbGA7XG5cbiAgICBzcWwgPSAnU0VMRUNUICogRlJPTSAnICsgdGFibGVOYW1lICsgKHNxbCA/ICcgV0hFUkUgJyArIHNxbCA6ICcnKTtcblxuICAgIGNvbnN0IHJvd3MgPSBhd2FpdCB0aGlzLmRiLmFsbChzcWwsIHZhbHVlcyk7XG5cbiAgICBjb25zdCByZWNvcmRzID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHJvdyBvZiByb3dzKSB7XG4gICAgICBjb25zdCBhdHRyaWJ1dGVzID0gUmVjb3JkLnF1ZXJ5Um93VG9BdHRyaWJ1dGVzKHJvdyk7XG5cbiAgICAgIGNvbnN0IHJlY29yZCA9IG5ldyBSZWNvcmQoYXR0cmlidXRlcywgdGhpcyk7XG5cbiAgICAgIHJlY29yZC5fZGIgPSB0aGlzLmRiO1xuXG4gICAgICByZWNvcmRzLnB1c2gocmVjb3JkKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVjb3JkcztcbiAgfVxufVxuXG5QZXJzaXN0ZW50T2JqZWN0LnJlZ2lzdGVyKEZvcm0pO1xuIl19